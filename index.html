<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhoucong.top","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Vikebt&#39;s blog">
<meta property="og:url" content="http://zhoucong.top/index.html">
<meta property="og:site_name" content="Vikebt&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Vikebt">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://zhoucong.top/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Vikebt's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Vikebt's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">人生在勤，不索何获</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Vikebt</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/vikebt" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;vikebt" rel="noopener me" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2674761561@qq.com" title="E-Mail → mailto:2674761561@qq.com" rel="noopener me" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/oracleboxman" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;oracleboxman" rel="noopener me" target="_blank"><i class="google fa-fw"></i>Google</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/%E8%93%9D%E7%89%99%E6%A8%A1%E5%9D%97%E9%80%89%E5%9E%8B%E5%8F%8A%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/%E8%93%9D%E7%89%99%E6%A8%A1%E5%9D%97%E9%80%89%E5%9E%8B%E5%8F%8A%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">蓝牙模块选型及基础知识</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-07-18 10:07:40" itemprop="dateModified" datetime="2021-07-18T10:07:40+08:00">2021-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文将讲述关于蓝牙的基础知识和蓝牙模块的选型介绍。对于开始学习蓝牙或者要用蓝牙做项目的你有一定的帮助。</p>
<h2 id="蓝牙基础知识"><a href="#蓝牙基础知识" class="headerlink" title="蓝牙基础知识"></a>蓝牙基础知识</h2><h3 id="蓝牙发展"><a href="#蓝牙发展" class="headerlink" title="蓝牙发展"></a>蓝牙发展</h3><p>自1998.10.19发布蓝牙0.7标准以来，目前蓝牙已经发展到5.0以上。蓝牙发展到3.0标准之后推出了蓝牙4.0BLE（BLE:全称为Bluetooth Low Energy）。可以看出蓝牙规范4.0最重要的一个特性就是低功耗。</p>
<p>4.0BLE使得蓝牙设备可通过一粒纽扣电池供电以维持续工作数年之久，而且最大速率与3.0一样还是24Mbs。BLE的低功耗可以更好地配合单片机使用。所以大部分的蓝牙模块都是使用BLE。</p>
<h3 id="苹果MFI认证"><a href="#苹果MFI认证" class="headerlink" title="苹果MFI认证"></a>苹果MFI认证</h3><p>蓝牙4.0之前，只有IOS设备和苹果认证的MFI蓝牙设备才可以被ios检索到，也就是说只有过了MFI的蓝牙设备，才能和ISO设备连接并建立数据通道，因此要想和ISO设备APP通讯，必须过MFI认证 。</p>
<p>在蓝牙4.0出来以后，苹果开放了BLE通道，但硬件上要Iphone4s以上，系统要ios6 以上才支持4.0。另外受蓝牙4.0本身协议限制，BLE最大传输速率只能到8KB&#x2F;S左右，而且应用方面会有限制。</p>
<p>此处提一下安卓系统，安卓系统对于蓝牙的兼容性要比苹果好，市面上的蓝牙模块基本都是可以正常连接的，注意安卓4.3系统以上才开始全面支持BLE。</p>
<h3 id="蓝牙协议"><a href="#蓝牙协议" class="headerlink" title="蓝牙协议"></a>蓝牙协议</h3><p>这部分内容只是简要提一下常用协议，仅供了解。<br>（1）核心协议：BaseBand、LMP、L2CAP、SDP；<br>（2）电缆替代协议：RFCOMM；<br>（3）电话传送控制协议：TCS-Binary、AT命令集；<br>（4）选用协议：PPP、UDP&#x2F;TCP&#x2F;IP、OBEX、WAP、vCard、vCal、IrMC、WAE。</p>
<h3 id="蓝牙与单片机通信方式"><a href="#蓝牙与单片机通信方式" class="headerlink" title="蓝牙与单片机通信方式"></a>蓝牙与单片机通信方式</h3><p>蓝牙与单片机主要通过串口通信，蓝牙可以作为主机和从机。有些模块不支持主机，选择模块时要注意看是否支持主机。<br>连接时注意蓝牙的TXD接单片机RXD，蓝牙的RXD接单片机TXD。</p>
<h3 id="蓝牙单模"><a href="#蓝牙单模" class="headerlink" title="蓝牙单模"></a>蓝牙单模</h3><p>所谓的蓝牙单模就是仅支持标准蓝牙版本或者BLE。两者仅支持其中一个。</p>
<h3 id="蓝牙双模"><a href="#蓝牙双模" class="headerlink" title="蓝牙双模"></a>蓝牙双模</h3><p>蓝牙双模无疑是未来的主流。经典蓝牙功耗较大，而且上述也提到需要得到MFI认证才能连接苹果，4.0以后的蓝牙BLE功耗小，但不支持音频协议及受数据传输速度限制，蓝牙双模则是综合了两者的优缺点，既可以支持音频传输，同样可支持数据传输，功耗低，并且兼容性也是两者之和。</p>
<h3 id="iBeacon"><a href="#iBeacon" class="headerlink" title="iBeacon"></a>iBeacon</h3><p>iBeacon是基于蓝牙4.0BLE由苹果推出的一项室内定位技术。<br>其工作方式是，向周围发送自己特有的ID，接收到该ID的应用软件会根据该ID采取一些行动。比如，在店铺里设置iBeacon通信模块的话，便可让iPhone和iPad上运行一资讯告知服务器，或者由服务器向顾客发送折扣券及进店积分。此外，还可以在家电发生故障或停止工作时使用iBeacon向应用软件发送资讯。说白了就是一种广播通信。</p>
<h2 id="蓝牙模块选型"><a href="#蓝牙模块选型" class="headerlink" title="蓝牙模块选型"></a>蓝牙模块选型</h2><h3 id="HC蓝牙模块"><a href="#HC蓝牙模块" class="headerlink" title="HC蓝牙模块"></a>HC蓝牙模块</h3><p>HC公司蓝牙模块被广泛应用，从销量可以看出。本文针对HC公司的蓝牙模块进行介绍。</p>
<h3 id="处于淘汰边缘的HC-05"><a href="#处于淘汰边缘的HC-05" class="headerlink" title="处于淘汰边缘的HC-05"></a>处于淘汰边缘的HC-05</h3><p>说起蓝牙模块，很多人都会联想到HC-05，确实HC-05很实用，但它已经处于淘汰边缘了。HC-05是蓝牙2.0的，与单片机通信没有任何问题，但是2.0已经非常落后了。可以说没什么学习价值，如果要做依赖蓝牙的项目，HC-05难以承担重任。<br>还有重要的一点，如果用苹果手机是没有办法做测试的，上文蓝牙基础知识中也有提到。</p>
<h3 id="HC蓝牙模块选型"><a href="#HC蓝牙模块选型" class="headerlink" title="HC蓝牙模块选型"></a>HC蓝牙模块选型</h3><p>截至文章发布时间，下图是比较实用的HC蓝牙模块</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/W3PfWq"><img src="https://z3.ax1x.com/2021/07/18/W3PfWq.jpg" alt="W3PfWq.jpg"></a></p>
<p>截至文章发布时间，图中价格是某宝中的价格。<br>从图中可以看出，如果只是作为从机使用，HC-04性价比是最高的。HC-04的双模是SPP2.1和BLE4.0。<br>如果要主从一体，推荐HC-42，HC-42支持蓝牙5.0BLE，还支持ibeacon（关于ibeacon上文有介绍），当然也可以考虑HC-08。<br>关于速度方面，从图中可以看出几个模块都是差不多的。<br>以上模块均支持苹果和安卓，苹果需要用支持BLE的软件。</p>
<p>————————————————<br>版权声明：本文为CSDN博主「微光feng」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46554815/article/details/113193127">https://blog.csdn.net/qq_46554815/article/details/113193127</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A851%E5%8D%95%E7%89%87%E6%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A851%E5%8D%95%E7%89%87%E6%9C%BA/" class="post-title-link" itemprop="url">简单入门51单片机</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-07 09:23:02" itemprop="dateModified" datetime="2020-12-07T09:23:02+08:00">2020-12-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="初识51单片机"><a href="#初识51单片机" class="headerlink" title="初识51单片机"></a>初识51单片机</h3><p>我使用的是开拓者提供的51单片机，资料打包如下：</p>
<p><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1gQ07aX-uIHPLd3xZ4Pa56g">开拓者V2光盘资料</a> 提取码: 85nk </p>
<h4 id="STC89C51RC-RD-系列单片机简介"><a href="#STC89C51RC-RD-系列单片机简介" class="headerlink" title="STC89C51RC&#x2F;RD+系列单片机简介"></a>STC89C51RC&#x2F;RD+系列单片机简介</h4><p>STC89C51RC&#x2F;RD+系列单片机（包括STC89C52RC）是宏晶科技推出的新一代超强抗干扰、高速、低功耗的单片机，与传统8051系列单片机的指令和引脚完全兼容。12时钟&#x2F;机器周期和6时钟&#x2F;机器周期可任意选择。</p>
<h5 id="命名规则"><a href="#命名规则" class="headerlink" title="命名规则"></a>命名规则</h5><p><img src="https://i.loli.net/2020/12/05/eEqtN7Hrz2ZlU6a.png" alt="2.png"></p>
<h5 id="主要特性"><a href="#主要特性" class="headerlink" title="主要特性"></a>主要特性</h5><p><img src="https://i.loli.net/2020/12/05/1ukAirLI7dxbeXj.png" alt="3.png"></p>
<h5 id="引脚封装"><a href="#引脚封装" class="headerlink" title="引脚封装"></a>引脚封装</h5><p><img src="https://i.loli.net/2020/12/05/pGAZv8HeObRUh54.png" alt="4.png"></p>
<h5 id="产品选型表"><a href="#产品选型表" class="headerlink" title="产品选型表"></a>产品选型表</h5><p><img src="https://i.loli.net/2020/12/05/8kacmQiPXFMo1fD.png" alt="5.png"></p>
<h4 id="开发板实物图"><a href="#开发板实物图" class="headerlink" title="开发板实物图"></a>开发板实物图</h4><p><img src="https://i.loli.net/2020/12/05/NEkBiIbgx8SuqA6.jpg" alt="6.jpg"></p>
<p><img src="https://i.loli.net/2020/12/05/yRMpA3JiZanHINW.jpg" alt="7.jpg"></p>
<h3 id="LED灯相关"><a href="#LED灯相关" class="headerlink" title="LED灯相关"></a>LED灯相关</h3><h4 id="LED简介"><a href="#LED简介" class="headerlink" title="LED简介"></a>LED简介</h4><h5 id="LED介绍"><a href="#LED介绍" class="headerlink" title="LED介绍"></a>LED介绍</h5><p>LED即发光二极管，它是一种能将电能转化为光能的半导体电子元件。<br>普通小功率LED电压范围：1.8-2.4V，电流为：20mA</p>
<h5 id="如何点亮LED"><a href="#如何点亮LED" class="headerlink" title="如何点亮LED"></a>如何点亮LED</h5><p>LED具有单向导通性，只能往一个方向导通。正极→负极</p>
<h4 id="LED模块电路"><a href="#LED模块电路" class="headerlink" title="LED模块电路"></a>LED模块电路</h4><p><img src="https://i.loli.net/2020/12/05/bjtzDLiroPOcW4F.png" alt="8.png"></p>
<h4 id="编写程序"><a href="#编写程序" class="headerlink" title="编写程序"></a>编写程序</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              LED测试实验												  *</span></span><br><span class="line"><span class="comment">实现现象：依程序设定，使LED灯正常工作</span></span><br><span class="line"><span class="comment">注意事项：无																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;	</span><br><span class="line"></span><br><span class="line">sbit led1=P2^<span class="number">0</span>;	  <span class="comment">//将单片机的P2.0端口定义为led1</span></span><br><span class="line">sbit led2=P2^<span class="number">1</span>;	  <span class="comment">//将单片机的P2.1端口定义为led2</span></span><br><span class="line">sbit led3=P2^<span class="number">2</span>;	  <span class="comment">//将单片机的P2.2端口定义为led3</span></span><br><span class="line">sbit led4=P2^<span class="number">3</span>;	  <span class="comment">//将单片机的P2.3端口定义为led4</span></span><br><span class="line">sbit led5=P2^<span class="number">4</span>;	  <span class="comment">//将单片机的P2.4端口定义为led5</span></span><br><span class="line">sbit led6=P2^<span class="number">5</span>;	  <span class="comment">//将单片机的P2.5端口定义为led6</span></span><br><span class="line">sbit led7=P2^<span class="number">6</span>;	  <span class="comment">//将单片机的P2.6端口定义为led7</span></span><br><span class="line">sbit led8=P2^<span class="number">7</span>;	  <span class="comment">//将单片机的P2.7端口定义为led8</span></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		led1=<span class="number">0</span>,led4=<span class="number">0</span>,led7=<span class="number">0</span>,led8=<span class="number">0</span>; <span class="comment">//点亮红灯</span></span><br><span class="line">		delay(<span class="number">50000</span>); <span class="comment">//大约延时450ms</span></span><br><span class="line">		led1=<span class="number">1</span>,led4=<span class="number">1</span>,led7=<span class="number">1</span>,led8=<span class="number">1</span>;  <span class="comment">//熄灭红灯</span></span><br><span class="line">		delay(<span class="number">50000</span>); <span class="comment">//大约延时450ms	</span></span><br><span class="line">		</span><br><span class="line">		led2=<span class="number">0</span>,led5=<span class="number">0</span>;		  <span class="comment">//点亮黄灯</span></span><br><span class="line">		delay(<span class="number">50000</span>); <span class="comment">//大约延时450ms</span></span><br><span class="line">		led2=<span class="number">1</span>,led5=<span class="number">1</span>;		  <span class="comment">//熄灭黄灯</span></span><br><span class="line">		delay(<span class="number">50000</span>); <span class="comment">//大约延时450ms	</span></span><br><span class="line">		</span><br><span class="line">		led3=<span class="number">0</span>,led6=<span class="number">0</span>;		  <span class="comment">//点亮绿灯</span></span><br><span class="line">		delay(<span class="number">50000</span>); <span class="comment">//大约延时450ms</span></span><br><span class="line">		led3=<span class="number">1</span>,led6=<span class="number">1</span>;		  <span class="comment">//熄灭绿灯</span></span><br><span class="line">		delay(<span class="number">50000</span>); <span class="comment">//大约延时450ms	</span></span><br><span class="line">		</span><br><span class="line">		led1=<span class="number">0</span>,led2=<span class="number">0</span>,led3=<span class="number">0</span>;<span class="comment">//点亮红黄绿</span></span><br><span class="line">		delay(<span class="number">50000</span>);  <span class="comment">//大约延时450ms</span></span><br><span class="line">		led1=<span class="number">1</span>,led2=<span class="number">1</span>,led3=<span class="number">1</span>;<span class="comment">//点亮红黄绿</span></span><br><span class="line">		delay(<span class="number">50000</span>);  <span class="comment">//大约延时450ms</span></span><br><span class="line">		</span><br><span class="line">		led4=<span class="number">0</span>,led5=<span class="number">0</span>,led6=<span class="number">0</span>;<span class="comment">//点亮红黄绿</span></span><br><span class="line">		delay(<span class="number">50000</span>);  <span class="comment">//大约延时450ms</span></span><br><span class="line">		led4=<span class="number">1</span>,led5=<span class="number">1</span>,led6=<span class="number">1</span>;<span class="comment">//点亮红黄绿</span></span><br><span class="line">		delay(<span class="number">50000</span>);  <span class="comment">//大约延时450ms</span></span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              LED流水灯实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后LED呈现流水灯效果进行左移右移滚动</span></span><br><span class="line"><span class="comment">注意事项：无																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;intrins.h&gt;</span>		<span class="comment">//因为要用到左右移函数，所以加入这个头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED P2	   <span class="comment">//将P2口定义为LED 后面就可以使用LED代替P2口</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	u8 i;</span><br><span class="line">	LED=<span class="number">0xfe</span>;</span><br><span class="line">	delay(<span class="number">50000</span>); <span class="comment">//大约延时450ms	</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;	</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1		<span class="comment">//条件编译  条件不满足不编译//貌似这种方法无法向右移位，所以一般采用使用移位函数的方法进行移位</span></span></span><br><span class="line">		LED=<span class="number">0xfe</span>;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			LED=~(~<span class="number">0xfe</span>&lt;&lt;i);	 <span class="comment">//将0右移i位，然后将结果赋值到P2口//		LED=~(~0x7f&gt;&gt;i);这个达不到与前面一样流水灯的效果</span></span><br><span class="line">			               <span class="comment">//总结：左移时总是移位和补零。右移时无符号数是移位和补零，此时称为逻辑右移;</span></span><br><span class="line">                     <span class="comment">//而有符号数大多数情况下是移位和补最左边的位（也就是补最高有效位），移几位就补几位,此时称为算术右移。</span></span><br><span class="line">			delay(<span class="number">50000</span>);			<span class="comment">//大约延时450ms</span></span><br><span class="line">	</span><br><span class="line">		&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">//如果想要流水从第八个灯开始的话，只能使用移位函数，不然会出现连亮的现象</span></span><br><span class="line"><span class="comment">//		LED=~(~0x7f&lt;&lt;i);         01111111</span></span><br><span class="line"><span class="comment">//														 10000000 取反</span></span><br><span class="line"><span class="comment">//														 1000000	移位</span></span><br><span class="line"><span class="comment">//														 11000000 补最左边数的位</span></span><br><span class="line"><span class="comment">//														 00111111 再取反</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0						 <span class="comment">//条件满足进行编译</span></span></span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">7</span>;i++)	 <span class="comment">//将led左移一位  11111110</span></span><br><span class="line">		&#123;</span><br><span class="line">			LED=_crol_(LED,<span class="number">1</span>);<span class="comment">//_cror_</span></span><br><span class="line">			delay(<span class="number">50000</span>); <span class="comment">//大约延时450ms	</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">7</span>;i++)	<span class="comment">//将led右移一位</span></span><br><span class="line">		&#123;</span><br><span class="line">			LED=_cror_(LED,<span class="number">1</span>);</span><br><span class="line">			delay(<span class="number">50000</span>); <span class="comment">//大约延时450ms	</span></span><br><span class="line">		&#125; </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="蜂鸣器报警"><a href="#蜂鸣器报警" class="headerlink" title="蜂鸣器报警"></a>蜂鸣器报警</h3><h4 id="蜂鸣器简介"><a href="#蜂鸣器简介" class="headerlink" title="蜂鸣器简介"></a>蜂鸣器简介</h4><p>蜂鸣器主要分为压电式蜂鸣器和电磁式蜂鸣器两种类型。<br>（1）压电式蜂鸣器主要由多谐振荡器、压电蜂鸣片、阻抗匹配器及共鸣箱、外壳等组成。多谐振荡器由晶体管或集成电路构成，当接通电源后（1.5~15V直流工作电压），多谐振荡器起振,输出1.5～5kHZ的音频信号，阻抗匹配器推动压电蜂鸣片发声。<br>（2）电磁式蜂鸣器由振荡器、电磁线圈、磁铁、振动膜片及外壳等组成。接通电源后，振荡器产生的音频信号电流通过电磁线圈，使电磁线圈产生磁场，振动膜片在电磁线圈和磁铁的相互作用下，周期性地振动发声。   </p>
<p>如何调节蜂鸣器发声音色及声音大小？<br>（1）改变单片机引脚输出波形的频率，就可以调整控制蜂鸣器音调，产生各种不同音色、音调的声音。<br>（2）改变输出的高低电平占空比，则可以控制蜂鸣器的声音大小。</p>
<h4 id="蜂鸣器模块电路"><a href="#蜂鸣器模块电路" class="headerlink" title="蜂鸣器模块电路"></a>蜂鸣器模块电路</h4><p><img src="https://i.loli.net/2020/12/06/XJaqRoG6pVN1gCf.png" alt="9.png"></p>
<h4 id="编写程序-1"><a href="#编写程序-1" class="headerlink" title="编写程序"></a>编写程序</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              蜂鸣器报警实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后蜂鸣器发声</span></span><br><span class="line"><span class="comment">注意事项：无																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;intrins.h&gt;</span>		<span class="comment">//因为要用到左右移函数，所以加入这个头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit beep=P1^<span class="number">5</span>;	   </span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;	</span><br><span class="line">		beep=~beep;</span><br><span class="line">		delay(<span class="number">50</span>); <span class="comment">//通过修改此延时时间达到不同的发声效果</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="数码管相关–74HC245"><a href="#数码管相关–74HC245" class="headerlink" title="数码管相关–74HC245"></a>数码管相关–74HC245</h3><h4 id="数码管简介"><a href="#数码管简介" class="headerlink" title="数码管简介"></a>数码管简介</h4><p>数码管是一种半导体发光器件，其基本单元是发光二极管。数码管也称为LED数码管，是由多个发光二极管封装在一起组成“8”字型的器件，引线已在内部连接完成，只需引出它们的各个笔划，公共电极。</p>
<p>LED数码管根据LED的不同接法可以分为2类：共阴数码管和共阳数码管。</p>
<p>如下图（b），左为共阴数码管，右为共阳数码管。</p>
<p><img src="https://i.loli.net/2020/12/06/czEyhjme6GBbSt8.png" alt="10.png"></p>
<p>  共阴数码管码表</p>
<p>0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d,</p>
<p> 0   1   2   3   4   5</p>
<p>0x7d, 0x07, 0x7f, 0x6f, 0x77, 0x7c,</p>
<p> 6   7   8   9   A   B</p>
<p>0x39, 0x5e, 0x79, 0x71, 0x00,</p>
<p> C   D   E   F  无显示</p>
<p>  共阳数码管码表</p>
<p>0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92,</p>
<p> 0   1   2   3   4   5</p>
<p>0x82, 0xF8, 0x80, 0x90, 0x88, 0x83,</p>
<p> 6   7   8   9   A   B</p>
<p>0xC6, 0xA1, 0x86, 0x8E, 0xFF,</p>
<p>C   D   E   F  无显示</p>
<h4 id="数码管模块电路"><a href="#数码管模块电路" class="headerlink" title="数码管模块电路"></a>数码管模块电路</h4><p><img src="https://i.loli.net/2020/12/06/p2qFLnlsf4yvYzN.png" alt="11.png"></p>
<h4 id="程序编写"><a href="#程序编写" class="headerlink" title="程序编写"></a>程序编写</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              数码管静态显示实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后数码管静态显示我的生日。</span></span><br><span class="line"><span class="comment">注意事项：将LED点阵模块的J1短接片短接到VCC端																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit LSA=P3^<span class="number">0</span>;	 <span class="comment">//38译码器控制引脚</span></span><br><span class="line">sbit LSB=P3^<span class="number">1</span>;</span><br><span class="line">sbit LSC=P3^<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">u8 code smgduan[<span class="number">17</span>]=&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,</span><br><span class="line">					<span class="number">0x7f</span>,<span class="number">0x6f</span>,<span class="number">0x77</span>,<span class="number">0x7c</span>,<span class="number">0x39</span>,<span class="number">0x5e</span>,<span class="number">0x79</span>,<span class="number">0x71</span>&#125;;<span class="comment">//显示0~F的值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	<span class="comment">//</span></span><br><span class="line">&#125;					</span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	LSA=<span class="number">0</span>;</span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">2</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">1</span>;</span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">0</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">0</span>;</span><br><span class="line">	LSB=<span class="number">1</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">0</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">1</span>;</span><br><span class="line">	LSB=<span class="number">1</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">1</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">0</span>;</span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">1</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">0</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">1</span>;</span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">1</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">7</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">0</span>;</span><br><span class="line">	LSB=<span class="number">1</span>;</span><br><span class="line">	LSC=<span class="number">1</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">2</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">1</span>;</span><br><span class="line">	LSB=<span class="number">1</span>;</span><br><span class="line">	LSC=<span class="number">1</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">5</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">0</span>;</span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">1</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">2</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">1</span>;</span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">1</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">0</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">0</span>;</span><br><span class="line">	LSB=<span class="number">1</span>;</span><br><span class="line">	LSC=<span class="number">1</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">0</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">1</span>;</span><br><span class="line">	LSB=<span class="number">1</span>;</span><br><span class="line">	LSC=<span class="number">1</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">1</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">0</span>;</span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">0</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">1</span>;</span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">7</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">0</span>;</span><br><span class="line">	LSB=<span class="number">1</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">2</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	</span><br><span class="line">	LSA=<span class="number">1</span>;</span><br><span class="line">	LSB=<span class="number">1</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;	<span class="comment">//控制38译码器的Y0输出低电平</span></span><br><span class="line">	P0=smgduan[<span class="number">5</span>];</span><br><span class="line">	delay(<span class="number">50000</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              数码管动态显示实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后数码管从左至右显示0-7。</span></span><br><span class="line"><span class="comment">注意事项：将LED点阵模块的J1短接片短接到VCC端																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit LSA=P3^<span class="number">0</span>;</span><br><span class="line">sbit LSB=P3^<span class="number">1</span>;</span><br><span class="line">sbit LSC=P3^<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">u8 code smgduan[<span class="number">17</span>]=&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,</span><br><span class="line">					<span class="number">0x7f</span>,<span class="number">0x6f</span>,<span class="number">0x77</span>,<span class="number">0x7c</span>,<span class="number">0x39</span>,<span class="number">0x5e</span>,<span class="number">0x79</span>,<span class="number">0x71</span>&#125;;<span class="comment">//显示0~F的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : DigDisplay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 数码管动态扫描函数，循环扫描8个数码管显示</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">DigDisplay</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	u8 i;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">switch</span>(i)	 <span class="comment">//位选，选择点亮的数码管，</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">case</span>(<span class="number">0</span>):</span><br><span class="line">				LSA=<span class="number">0</span>;LSB=<span class="number">0</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第0位</span></span><br><span class="line">			<span class="keyword">case</span>(<span class="number">1</span>):</span><br><span class="line">				LSA=<span class="number">1</span>;LSB=<span class="number">0</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第1位</span></span><br><span class="line">			<span class="keyword">case</span>(<span class="number">2</span>):</span><br><span class="line">				LSA=<span class="number">0</span>;LSB=<span class="number">1</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第2位</span></span><br><span class="line">			<span class="keyword">case</span>(<span class="number">3</span>):</span><br><span class="line">				LSA=<span class="number">1</span>;LSB=<span class="number">1</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第3位</span></span><br><span class="line">			<span class="keyword">case</span>(<span class="number">4</span>):</span><br><span class="line">				LSA=<span class="number">0</span>;LSB=<span class="number">0</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;<span class="comment">//显示第4位</span></span><br><span class="line">			<span class="keyword">case</span>(<span class="number">5</span>):</span><br><span class="line">				LSA=<span class="number">1</span>;LSB=<span class="number">0</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;<span class="comment">//显示第5位</span></span><br><span class="line">			<span class="keyword">case</span>(<span class="number">6</span>):</span><br><span class="line">				LSA=<span class="number">0</span>;LSB=<span class="number">1</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;<span class="comment">//显示第6位</span></span><br><span class="line">			<span class="keyword">case</span>(<span class="number">7</span>):</span><br><span class="line">				LSA=<span class="number">1</span>;LSB=<span class="number">1</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;<span class="comment">//显示第7位	</span></span><br><span class="line">		&#125;</span><br><span class="line">		P0=smgduan[i];<span class="comment">//发送段码</span></span><br><span class="line">		delay(<span class="number">100</span>); <span class="comment">//间隔一段时间扫描	全部显示</span></span><br><span class="line">		<span class="comment">//delay(1000);    闪烁</span></span><br><span class="line">		P0=<span class="number">0x00</span>;<span class="comment">//消隐</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;	</span><br><span class="line">		DigDisplay();  <span class="comment">//数码管显示函数	</span></span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="独立按键"><a href="#独立按键" class="headerlink" title="独立按键"></a>独立按键</h3><h4 id="按键简介"><a href="#按键简介" class="headerlink" title="按键简介"></a>按键简介</h4><p>按键是一种电子开关，使用时轻轻按下开关按钮就可使开关接</p>
<p>通，当松开手时,开关断开。</p>
<p><img src="https://i.loli.net/2020/12/06/G9MAo5rs3JHRXCn.png" alt="12.png"></p>
<p>通常的按键所用开关为机械弹性开关,当机械触点断开 、闭合</p>
<p>时，电压信号如下：</p>
<p><img src="https://i.loli.net/2020/12/06/Gc8dxJ541k3PmXl.png" alt="13.png"></p>
<h4 id="独立按键模块电路"><a href="#独立按键模块电路" class="headerlink" title="独立按键模块电路"></a>独立按键模块电路</h4><p><img src="https://i.loli.net/2020/12/06/yVR1zuKLsj7T5gJ.png" alt="14.png"></p>
<h4 id="程序编写-1"><a href="#程序编写-1" class="headerlink" title="程序编写"></a>程序编写</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              独立按键实验												  *</span></span><br><span class="line"><span class="comment">实现现象：四个独立按键分别控制一个LED的状态</span></span><br><span class="line"><span class="comment">注意事项：无																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit k1=P1^<span class="number">4</span>;		<span class="comment">//定义P14口是k1</span></span><br><span class="line">sbit k2=P1^<span class="number">6</span>;		<span class="comment">//定义P16口是k2</span></span><br><span class="line">sbit k3=P3^<span class="number">2</span>;		<span class="comment">//定义P32口是k3</span></span><br><span class="line">sbit k4=P1^<span class="number">7</span>;		<span class="comment">//定义P17口是k4</span></span><br><span class="line"></span><br><span class="line">sbit led1=P2^<span class="number">0</span>;		<span class="comment">//定义P20口是led1</span></span><br><span class="line">sbit led2=P2^<span class="number">1</span>;		<span class="comment">//定义P21口是led2</span></span><br><span class="line">sbit led3=P2^<span class="number">2</span>;		<span class="comment">//定义P22口是led3</span></span><br><span class="line">sbit led4=P2^<span class="number">3</span>;		<span class="comment">//定义P23口是led4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : keypros</span></span><br><span class="line"><span class="comment">* 函数功能		   : 按键处理函数，判断按键K1是否按下</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">keypros</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(k1==<span class="number">0</span>)		  <span class="comment">//检测按键K1是否按下</span></span><br><span class="line">	&#123;	</span><br><span class="line">		delay(<span class="number">1000</span>);   <span class="comment">//消除抖动 一般大约10ms</span></span><br><span class="line">		<span class="keyword">if</span>(k1==<span class="number">0</span>)	 <span class="comment">//再次判断按键是否按下</span></span><br><span class="line">		&#123; </span><br><span class="line">	  	led1=~led1;	  <span class="comment">//led状态取反</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span>(!k1);	 <span class="comment">//检测按键是否松开</span></span><br><span class="line">	&#125;	</span><br><span class="line">	</span><br><span class="line">  	<span class="keyword">if</span>(k2==<span class="number">0</span>)		  <span class="comment">//检测按键K1是否按下</span></span><br><span class="line">	&#123;	</span><br><span class="line">		delay(<span class="number">1000</span>);   <span class="comment">//消除抖动 一般大约10ms</span></span><br><span class="line">		<span class="keyword">if</span>(k2==<span class="number">0</span>)	 <span class="comment">//再次判断按键是否按下</span></span><br><span class="line">		&#123; </span><br><span class="line">	  	led2=~led2;	  <span class="comment">//led状态取反</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span>(!k2);	 <span class="comment">//检测按键是否松开</span></span><br><span class="line">	&#125;	</span><br><span class="line">	</span><br><span class="line">	 <span class="keyword">if</span>(k3==<span class="number">0</span>)		  <span class="comment">//检测按键K1是否按下</span></span><br><span class="line">	&#123;	</span><br><span class="line">		delay(<span class="number">1000</span>);   <span class="comment">//消除抖动 一般大约10ms</span></span><br><span class="line">		<span class="keyword">if</span>(k3==<span class="number">0</span>)	 <span class="comment">//再次判断按键是否按下</span></span><br><span class="line">		&#123; </span><br><span class="line">	  	led3=~led3;	  <span class="comment">//led状态取反</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span>(!k3);	 <span class="comment">//检测按键是否松开</span></span><br><span class="line">	&#125;	</span><br><span class="line">	</span><br><span class="line">	  <span class="keyword">if</span>(k4==<span class="number">0</span>)		  <span class="comment">//检测按键K1是否按下</span></span><br><span class="line">	&#123;	</span><br><span class="line">		delay(<span class="number">1000</span>);   <span class="comment">//消除抖动 一般大约10ms</span></span><br><span class="line">		<span class="keyword">if</span>(k4==<span class="number">0</span>)	 <span class="comment">//再次判断按键是否按下</span></span><br><span class="line">		&#123; </span><br><span class="line">	  	led4=~led4;	  <span class="comment">//led状态取反</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span>(!k4);	 <span class="comment">//检测按键是否松开</span></span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;	</span><br><span class="line">		keypros();  <span class="comment">//按键处理函数	</span></span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="矩阵按键-4X4"><a href="#矩阵按键-4X4" class="headerlink" title="矩阵按键(4X4)"></a>矩阵按键(4X4)</h3><h4 id="4X4矩阵按键简介"><a href="#4X4矩阵按键简介" class="headerlink" title="4X4矩阵按键简介"></a>4X4矩阵按键简介</h4><p>​		在键盘中按键数量较多时，为了减少I&#x2F;O口的占用，通常将按键<br>排列成矩阵形式。在矩阵式键盘中，每条水平线和垂直线在交叉处<br>不直接连通，而是通过一个按键加以连接。</p>
<p>矩阵按键识别方法：<br>（1）逐行扫描<br>      可以通过高四位轮流输出低电平来对矩阵键盘进行逐行<br>扫描，当低四位接收到的数据不全为1的时候，说明有按键按下，<br>然后通过接收到的数据是哪一位为0来判断是哪一个按键被按下。<br>（2）行列扫描<br>      可以通过高四位全部输出低电平，低四位输出高电平。当接收到的数据，低四位<br>不全为高电平时，说明有按键按下，然后通过接收的数据值，判断是哪一列有按键<br>按下，然后再反过来，高四位输出高电平，低四位输出低电平，然后根据接收到的高四位的<br>值判断是那一行有按键按下，这样就能够确定是哪一个按键按下了。</p>
<h4 id="4X4矩阵按键模块电路"><a href="#4X4矩阵按键模块电路" class="headerlink" title="4X4矩阵按键模块电路"></a>4X4矩阵按键模块电路</h4><p><img src="https://i.loli.net/2020/12/06/8UnxjIoEHB3YKtC.png" alt="15.png"></p>
<h4 id="编写程序-2"><a href="#编写程序-2" class="headerlink" title="编写程序"></a>编写程序</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              矩阵按键实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后数码管显示0，按下矩阵按键上的按键显示对应的数字</span></span><br><span class="line"><span class="comment">			S1-S4：0-3</span></span><br><span class="line"><span class="comment">			S5-S8：4-7</span></span><br><span class="line"><span class="comment">			S9-S12：8-B</span></span><br><span class="line"><span class="comment">			S13-S16：C-F</span></span><br><span class="line"><span class="comment">注意事项：																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIO_DIG P0	  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIO_KEY P1</span></span><br><span class="line"></span><br><span class="line">sbit LSA=P3^<span class="number">0</span>;</span><br><span class="line">sbit LSB=P3^<span class="number">1</span>;</span><br><span class="line">sbit LSC=P3^<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">u8 KeyValue;	<span class="comment">//用来存放读取到的键值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">u8 code smgduan[<span class="number">17</span>]=&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,</span><br><span class="line">					<span class="number">0x7f</span>,<span class="number">0x6f</span>,<span class="number">0x77</span>,<span class="number">0x7c</span>,<span class="number">0x39</span>,<span class="number">0x5e</span>,<span class="number">0x79</span>,<span class="number">0x71</span>&#125;;<span class="comment">//显示0~F的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : KEY_Scan</span></span><br><span class="line"><span class="comment">* 函数功能		   : 检测按键是否按下并读取键值</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">KEY_Scan</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> a=<span class="number">0</span>;</span><br><span class="line">	GPIO_KEY=<span class="number">0x0f</span>;</span><br><span class="line">	<span class="keyword">if</span>(GPIO_KEY!=<span class="number">0x0f</span>)<span class="comment">//读取按键是否按下</span></span><br><span class="line">	&#123;</span><br><span class="line">		delay(<span class="number">1000</span>);<span class="comment">//延时10ms进行消抖</span></span><br><span class="line">		<span class="keyword">if</span>(GPIO_KEY!=<span class="number">0x0f</span>)<span class="comment">//再次检测键盘是否按下</span></span><br><span class="line">		&#123;	</span><br><span class="line">			<span class="comment">//测试列</span></span><br><span class="line">			GPIO_KEY=<span class="number">0X0F</span>;</span><br><span class="line">			<span class="keyword">switch</span>(GPIO_KEY)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">case</span>(<span class="number">0X07</span>):	KeyValue=<span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span>(<span class="number">0X0b</span>):	KeyValue=<span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span>(<span class="number">0X0d</span>): KeyValue=<span class="number">2</span>;<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span>(<span class="number">0X0e</span>):	KeyValue=<span class="number">3</span>;<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//测试行</span></span><br><span class="line">			GPIO_KEY=<span class="number">0XF0</span>;</span><br><span class="line">			<span class="keyword">switch</span>(GPIO_KEY)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">case</span>(<span class="number">0X70</span>):	KeyValue=KeyValue;<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span>(<span class="number">0Xb0</span>):	KeyValue=KeyValue+<span class="number">4</span>;<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span>(<span class="number">0Xd0</span>): KeyValue=KeyValue+<span class="number">8</span>;<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span>(<span class="number">0Xe0</span>):	KeyValue=KeyValue+<span class="number">12</span>;<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">while</span>((a&lt;<span class="number">50</span>)&amp;&amp;(GPIO_KEY!=<span class="number">0xf0</span>))	 <span class="comment">//检测按键松手检测，防止占用CPU</span></span><br><span class="line">			&#123;</span><br><span class="line">				delay(<span class="number">1000</span>);</span><br><span class="line">				a++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	LSA=<span class="number">0</span>; <span class="comment">//给一个数码管提供位选</span></span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;	</span><br><span class="line">		KEY_Scan();		   <span class="comment">//按键判断函数</span></span><br><span class="line">		GPIO_DIG=smgduan[KeyValue];	  <span class="comment">//</span></span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="点阵（8X8）–74HC595"><a href="#点阵（8X8）–74HC595" class="headerlink" title="点阵（8X8）–74HC595"></a>点阵（8X8）–74HC595</h3><h4 id="8X8LED点阵简介"><a href="#8X8LED点阵简介" class="headerlink" title="8X8LED点阵简介"></a>8X8LED点阵简介</h4><p>LED点阵是由发光二极管排列组成的显示器件,在我们日常生活的电器中随处可见，被广泛应用于汽车报站器，广告屏等。</p>
<p><img src="https://i.loli.net/2020/12/06/HgnKmUIsxOVa853.png" alt="16.png"></p>
<p>8*8LED点阵内部结构：</p>
<p><img src="https://i.loli.net/2020/12/06/z8edNqnhEp9xmJl.png" alt="17.png"></p>
<h4 id="8X8LED点阵模块电路"><a href="#8X8LED点阵模块电路" class="headerlink" title="8X8LED点阵模块电路"></a>8X8LED点阵模块电路</h4><p><img src="https://i.loli.net/2020/12/06/tFXHRcvlgIpM4Zh.png" alt="18.png"></p>
<h4 id="编写程序-3"><a href="#编写程序-3" class="headerlink" title="编写程序"></a>编写程序</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              8*8点阵--点亮一个点实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后点阵从左上角第一个点亮，沿一条对角线等比例点亮，直至全亮</span></span><br><span class="line"><span class="comment">			</span></span><br><span class="line"><span class="comment">注意事项：一定要将LED点阵模块上的J1短接片短接到GND端</span></span><br><span class="line"><span class="comment">			数码管的段选和点阵列共用P0口，而38译码器默认是Y7输出，即数码管最后一个会点亮																			  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg51.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;intrins.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit SRCLK=P3^<span class="number">6</span>;</span><br><span class="line">sbit RCLK=P3^<span class="number">5</span>;</span><br><span class="line">sbit SER=P3^<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函数名         : HC595SendByte(u8 dat)</span></span><br><span class="line"><span class="comment">* 函数功能		   : 向74HC595发送一个字节的数据</span></span><br><span class="line"><span class="comment">* 输入           : 无</span></span><br><span class="line"><span class="comment">* 输出         	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HC595SendByte</span><span class="params">(u8 dat)</span></span><br><span class="line">&#123;</span><br><span class="line">	u8 a;</span><br><span class="line">	SRCLK=<span class="number">0</span>;</span><br><span class="line">	RCLK=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(a=<span class="number">0</span>;a&lt;<span class="number">8</span>;a++)</span><br><span class="line">	&#123;</span><br><span class="line">		SER=dat&gt;&gt;<span class="number">7</span>;</span><br><span class="line">		dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		SRCLK=<span class="number">1</span>;</span><br><span class="line">		_nop_();</span><br><span class="line">		_nop_();</span><br><span class="line">		SRCLK=<span class="number">0</span>;	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	RCLK=<span class="number">1</span>;</span><br><span class="line">	_nop_();</span><br><span class="line">	_nop_();</span><br><span class="line">	RCLK=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;			</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		HC595SendByte(<span class="number">0x80</span>);   <span class="comment">//74HC595控制点阵行</span></span><br><span class="line">		P0=<span class="number">0x7f</span>;			   <span class="comment">//P0控制点阵列</span></span><br><span class="line">		delay(<span class="number">50000</span>);</span><br><span class="line">		HC595SendByte(<span class="number">0XC0</span>);</span><br><span class="line">		P0=<span class="number">0X3f</span>;</span><br><span class="line">		delay(<span class="number">50000</span>);</span><br><span class="line">		HC595SendByte(<span class="number">0XE0</span>);</span><br><span class="line">        P0=<span class="number">0X1f</span>;	</span><br><span class="line">		delay(<span class="number">50000</span>);</span><br><span class="line">		HC595SendByte(<span class="number">0XF0</span>);</span><br><span class="line">        P0=<span class="number">0X0f</span>;</span><br><span class="line">		delay(<span class="number">50000</span>);</span><br><span class="line">		HC595SendByte(<span class="number">0XF8</span>);</span><br><span class="line">        P0=<span class="number">0X07</span>;</span><br><span class="line">		delay(<span class="number">50000</span>);			</span><br><span class="line">		HC595SendByte(<span class="number">0XFC</span>);</span><br><span class="line">        P0=<span class="number">0X03</span>;</span><br><span class="line">		delay(<span class="number">50000</span>);			</span><br><span class="line">		HC595SendByte(<span class="number">0XFE</span>);</span><br><span class="line">        P0=<span class="number">0X01</span>;</span><br><span class="line">		delay(<span class="number">50000</span>);		</span><br><span class="line">		HC595SendByte(<span class="number">0XFF</span>);</span><br><span class="line">        P0=<span class="number">0X00</span>;</span><br><span class="line">		delay(<span class="number">50000</span>);			</span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              8*8点阵--显示数字实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后点阵上显示数字0（或1）</span></span><br><span class="line"><span class="comment">			</span></span><br><span class="line"><span class="comment">注意事项：一定要将LED点阵模块上的J1短接片短接到GND端																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg51.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;intrins.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit SRCLK=P3^<span class="number">6</span>;</span><br><span class="line">sbit RCLK=P3^<span class="number">5</span>;</span><br><span class="line">sbit SER=P3^<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">u8 ledduan0[]=&#123;<span class="number">0X00</span>,<span class="number">0X00</span>,<span class="number">0X3E</span>,<span class="number">0X41</span>,<span class="number">0X41</span>,<span class="number">0X41</span>,<span class="number">0X3E</span>,<span class="number">0X00</span>&#125;;</span><br><span class="line">u8 ledduan1[]=&#123;<span class="number">0X00</span>,<span class="number">0X00</span>,<span class="number">0X24</span>,<span class="number">0X44</span>,<span class="number">0XFC</span>,<span class="number">0X04</span>,<span class="number">0X04</span>,<span class="number">0X00</span>&#125;;</span><br><span class="line">u8 ledwei[]=&#123;<span class="number">0X7f</span>,<span class="number">0Xbf</span>,<span class="number">0Xdf</span>,<span class="number">0Xef</span>,<span class="number">0Xf7</span>,<span class="number">0Xfb</span>,<span class="number">0Xfd</span>,<span class="number">0Xfe</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函数名         : HC595SendByte(u8 dat)</span></span><br><span class="line"><span class="comment">* 函数功能		   : 向74HC595发送一个字节的数据</span></span><br><span class="line"><span class="comment">* 输入           : 无</span></span><br><span class="line"><span class="comment">* 输出         	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HC595SendByte</span><span class="params">(u8 dat)</span></span><br><span class="line">&#123;</span><br><span class="line">	u8 a;</span><br><span class="line">	SRCLK=<span class="number">0</span>;</span><br><span class="line">	RCLK=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(a=<span class="number">0</span>;a&lt;<span class="number">8</span>;a++)</span><br><span class="line">	&#123;</span><br><span class="line">		SER=dat&gt;&gt;<span class="number">7</span>;</span><br><span class="line">		dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		SRCLK=<span class="number">1</span>;</span><br><span class="line">		_nop_();</span><br><span class="line">		_nop_();</span><br><span class="line">		SRCLK=<span class="number">0</span>;	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	RCLK=<span class="number">1</span>;</span><br><span class="line">	_nop_();</span><br><span class="line">	_nop_();</span><br><span class="line">	RCLK=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	u8 i,j;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		P0=<span class="number">0x7f</span>;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			P0=ledwei[i];</span><br><span class="line">			HC595SendByte(ledduan0[i]);</span><br><span class="line">			delay(<span class="number">100</span>);</span><br><span class="line">			HC595SendByte(<span class="number">0X00</span>);	</span><br><span class="line">		&#125;                                    <span class="comment">//显示数字0</span></span><br><span class="line"><span class="comment">//			for(j=0;j&lt;8;j++)</span></span><br><span class="line"><span class="comment">//		&#123;</span></span><br><span class="line"><span class="comment">//			P0=ledwei[j];</span></span><br><span class="line"><span class="comment">//			HC595SendByte(ledduan1[j]);</span></span><br><span class="line"><span class="comment">//			delay(100);</span></span><br><span class="line"><span class="comment">//			HC595SendByte(0X00);</span></span><br><span class="line"><span class="comment">//		&#125;                                    //显示数字1</span></span><br><span class="line"><span class="comment">//				</span></span><br><span class="line">	&#125;			</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="直流电机控制–TC1508S"><a href="#直流电机控制–TC1508S" class="headerlink" title="直流电机控制–TC1508S"></a>直流电机控制–TC1508S</h3><h4 id="直流电机简介"><a href="#直流电机简介" class="headerlink" title="直流电机简介"></a>直流电机简介</h4><p>直流电机是指能将直流电能转换成机械能的旋转电机。</p>
<p>相关参数：</p>
<p> 轴长：8mm</p>
<p> 轴径：2mm</p>
<p> 电压：1-6v</p>
<p> 参考电流：0.35-0.4A</p>
<p> 3v转速：17000-18000转每分钟</p>
<h4 id="直流电机驱动模块电路"><a href="#直流电机驱动模块电路" class="headerlink" title="直流电机驱动模块电路"></a>直流电机驱动模块电路</h4><p><img src="https://i.loli.net/2020/12/06/VzPjuSA1Zkv69K5.png" alt="19.png"></p>
<h4 id="编写程序-4"><a href="#编写程序-4" class="headerlink" title="编写程序"></a>编写程序</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              直流电机控制实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后，将直流电机引脚两端连接在电机驱动模块的A-和A+上，</span></span><br><span class="line"><span class="comment">			通过按键K1控制直流电机开启和停止	</span></span><br><span class="line"><span class="comment">注意事项：																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg51.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;intrins.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit motoa=P1^<span class="number">0</span>;	<span class="comment">//OUTA输出</span></span><br><span class="line">sbit motob=P1^<span class="number">1</span>;	<span class="comment">//OUTB输出</span></span><br><span class="line">sbit k1=P3^<span class="number">0</span>;  <span class="comment">//按键K1</span></span><br><span class="line"></span><br><span class="line">u8 mode=<span class="number">0</span>;</span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;			</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;	</span><br><span class="line">		<span class="keyword">if</span>(k1==<span class="number">0</span>)		<span class="comment">//判断K1是否按下</span></span><br><span class="line">		&#123;</span><br><span class="line">			delay(<span class="number">1000</span>);	<span class="comment">//消抖</span></span><br><span class="line">			<span class="keyword">if</span>(k1==<span class="number">0</span>)	   <span class="comment">//再次判断K1是否按下</span></span><br><span class="line">			&#123;</span><br><span class="line">				mode++;</span><br><span class="line">				<span class="keyword">if</span>(mode==<span class="number">2</span>)mode=<span class="number">0</span>;		</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">while</span>(!k1);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(mode==<span class="number">0</span>)	  <span class="comment">//停止</span></span><br><span class="line">		&#123;</span><br><span class="line">			motoa=<span class="number">0</span>;</span><br><span class="line">			motob=<span class="number">0</span>;	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(mode==<span class="number">1</span>)  <span class="comment">//开启</span></span><br><span class="line">		&#123;</span><br><span class="line">			motoa=<span class="number">0</span>;</span><br><span class="line">			motob=<span class="number">1</span>;		</span><br><span class="line">		&#125;</span><br><span class="line">						</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="中断系统"><a href="#中断系统" class="headerlink" title="中断系统"></a>中断系统</h3><h4 id="中断简介"><a href="#中断简介" class="headerlink" title="中断简介"></a>中断简介</h4><p><img src="https://i.loli.net/2020/12/06/Mk8CZTAsRc3bE5X.png" alt="20.png"></p>
<p>中断技术不仅解决了快速主机与慢速I&#x2F;O设备的数据传送问题，而且还具有如下优点：</p>
<p> ①分时操作。CPU可以分时为多个I&#x2F;O设备服务，提高了计算机的利用率；</p>
<p> ②实时响应。CPU能够及时处理应用系统的随机事件，系统的实时性大大增强；</p>
<p> ③可靠性高。CPU具有处理设备故障及掉电等突发性事件能力，从而使系统可靠性提高。</p>
<h4 id="中断系统结构"><a href="#中断系统结构" class="headerlink" title="中断系统结构"></a>中断系统结构</h4><p>89C51的中断系统有5个中断源 ，2个优先级，可实现二级中断嵌套。 </p>
<p><img src="https://i.loli.net/2020/12/06/CcZieDxOsVRmj1E.png" alt="21.png"></p>
<p> ①INT0(P3.2)，可由IT0(TCON.0)选择其为低电平有效还是下降沿有效。当CPU检测</p>
<p>到P3.2引脚上出现有效的中断信号时，中断标志IE0(TCON.1)置1，向CPU申请中断。 </p>
<p> ②INT1(P3.3)，可由IT1(TCON.2)选择其为低电平有效还是下降沿有效。当CPU检测</p>
<p>到P3.3引脚上出现有效的中断信号时，中断标志IE1(TCON.3)置1，向CPU申请中断。</p>
<p> ③T0(P3.4)，TF0（TCON.5），片内定时&#x2F;计数器T0溢出中断请求标志。当定时&#x2F;计</p>
<p>数器T0发生溢出时，置位TF0，并向CPU申请中断。</p>
<p> ④T1(P3.5)，TF1（TCON.7），片内定时&#x2F;计数器T1溢出中断请求标志。当定时&#x2F;计</p>
<p>数器T1发生溢出时，置位TF1，并向CPU申请中断。</p>
<p> ⑤RI（SCON.0）或TI（SCON.1），串行口中断请求标志。当串行口接收完一帧串行</p>
<p>数据时置位RI或当串行口发送完一帧串行数据时置位TI，向CPU申请中断。</p>
<p><img src="https://i.loli.net/2020/12/06/Ev2gFBKZzpMXDQN.png" alt="22.png"></p>
<h4 id="中断寄存器"><a href="#中断寄存器" class="headerlink" title="中断寄存器"></a>中断寄存器</h4><h5 id="定时器控制寄存器TCON"><a href="#定时器控制寄存器TCON" class="headerlink" title="定时器控制寄存器TCON"></a>定时器控制寄存器TCON</h5><p><img src="https://i.loli.net/2020/12/06/4TgwqaYFHU5m3z9.png" alt="22-1.png"></p>
<p>IT0：外部中断0触发方式控制位。当IT0&#x3D;0时，为电平触发方式。当IT0&#x3D;1时，为边沿触发方式（下降沿有效）。</p>
<p>IE0：外部中断0中断请求标志位。</p>
<p>IT1：外部中断1触发方式控制位。</p>
<p>IE1：外部中断1中断请求标志位。</p>
<p>TF0：定时&#x2F;计数器T0溢出中断请求标志位。</p>
<p>TF1：定时&#x2F;计数器T1溢出中断请求标志位。 </p>
<h5 id="中断允许寄存器IE"><a href="#中断允许寄存器IE" class="headerlink" title="中断允许寄存器IE"></a>中断允许寄存器IE</h5><p><img src="https://i.loli.net/2020/12/06/xNEmKunZfzbFh5I.png" alt="22-2.png"></p>
<p>EX0：外部中断0允许位；</p>
<p>ET0：定时&#x2F;计数器T0中断允许位； </p>
<p>EX1：外部中断0允许位；</p>
<p>ET1：定时&#x2F;计数器T1中断允许位；</p>
<p>ES： 串行口中断允许位；</p>
<p>EA ：CPU中断允许（总允许）位</p>
<h5 id="中断优先级寄存器IP"><a href="#中断优先级寄存器IP" class="headerlink" title="中断优先级寄存器IP"></a>中断优先级寄存器IP</h5><p><img src="https://i.loli.net/2020/12/06/ECk8IiexO5vrgLB.png" alt="22-3.png">PT2：定时器&#x2F;计数器2中断优先级控制位（仅8052）；1：高优先级，0：低优先级</p>
<p>PS：串行口优先级控制位；1：高优先级，0：低优先级</p>
<p>PT0&#x2F;PT1：定时器&#x2F;计数器0&#x2F;1中断优先级控制位；1：高优先级，0：低优先级 </p>
<p>PX0&#x2F;PX1：外部中断管0&#x2F;1中断优先级控制位；1：高优先级，0：低优先级</p>
<h4 id="中断优先级"><a href="#中断优先级" class="headerlink" title="中断优先级"></a>中断优先级</h4><p>同一优先级中的中断申请不止一个时，则有中断优先权排队问题。</p>
<p>同一优先级的中断优先权排队，由中断系统硬件确定的自然优先级</p>
<p>决定。</p>
<p><img src="https://i.loli.net/2020/12/06/7FJHPxWafsZtIiq.png" alt="23.png"></p>
<p> *中断执行原则： </p>
<p>①CPU同时接收到几个中断时，首先响应优先级别最高的中断请求。</p>
<p>②正在进行的中断过程不能被新的同级或低优先级的中断请求所中</p>
<p>断。</p>
<p>③正在进行的低优先级中断服务，能被高优先级中断请求所中断。</p>
<h4 id="中断的使用"><a href="#中断的使用" class="headerlink" title="中断的使用"></a>中断的使用</h4><p>中断响应条件</p>
<p> ①中断源要有中断请求</p>
<p> ②中断源的中断允许位为1</p>
<p> ③打开总中断（即EA&#x3D;1）</p>
<h3 id="外部中断"><a href="#外部中断" class="headerlink" title="外部中断"></a>外部中断</h3><h4 id="外部中断0–控制LED"><a href="#外部中断0–控制LED" class="headerlink" title="外部中断0–控制LED"></a>外部中断0–控制LED</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              外部中断0--控制LED实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后按下K3按键可以对D1小灯状态取反。</span></span><br><span class="line"><span class="comment">注意事项：无。																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit k3=P3^<span class="number">2</span>;  <span class="comment">//定义按键K3</span></span><br><span class="line">sbit led=P2^<span class="number">0</span>;	 <span class="comment">//定义P20口是led</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : Int1Init()</span></span><br><span class="line"><span class="comment">* 函数功能		   : 设置外部中断1</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Int0Init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//设置INT0</span></span><br><span class="line">	IT0=<span class="number">1</span>;<span class="comment">//跳变沿出发方式（下降沿）</span></span><br><span class="line">	EX0=<span class="number">1</span>;<span class="comment">//打开INT0的中断允许。	</span></span><br><span class="line">	EA=<span class="number">1</span>;<span class="comment">//打开总中断	</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	Int0Init();  <span class="comment">//	设置外部中断0</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>);		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : Int0()	interrupt 0</span></span><br><span class="line"><span class="comment">* 函数功能		   : 外部中断0的中断函数</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Int0</span><span class="params">()</span>	interrupt 0		<span class="comment">//外部中断0的中断函数</span></span><br><span class="line">&#123;</span><br><span class="line">	delay(<span class="number">1000</span>);	 <span class="comment">//延时消抖</span></span><br><span class="line">	<span class="keyword">if</span>(k3==<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		led=~led;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="外部中断1–控制蜂鸣器"><a href="#外部中断1–控制蜂鸣器" class="headerlink" title="外部中断1–控制蜂鸣器"></a>外部中断1–控制蜂鸣器</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              外部中断1--控制蜂鸣器实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后按下K4按键可以控制蜂鸣器发声。</span></span><br><span class="line"><span class="comment">注意事项：无。																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit k4=P3^<span class="number">3</span>;  <span class="comment">//定义按键K4</span></span><br><span class="line">sbit beep=P1^<span class="number">5</span>;	 <span class="comment">//定义P15口是beep</span></span><br><span class="line"></span><br><span class="line">u8 beep_flag=<span class="number">0</span>;  <span class="comment">//蜂鸣器报警标志位</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : delay</span></span><br><span class="line"><span class="comment">* 函数功能		   : 延时函数，i=1时，大约延时10us</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(u16 i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span>(i--);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : Int1Init()</span></span><br><span class="line"><span class="comment">* 函数功能		   : 设置外部中断1</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Int1Init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//设置INT1</span></span><br><span class="line">	IT1=<span class="number">1</span>;<span class="comment">//跳变沿出发方式（下降沿）</span></span><br><span class="line">	EX1=<span class="number">1</span>;<span class="comment">//打开INT1的中断允许。	</span></span><br><span class="line">	EA=<span class="number">1</span>;<span class="comment">//打开总中断	</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	Int1Init();  <span class="comment">//	设置外部中断1</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(beep_flag==<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			beep=!beep;</span><br><span class="line">			delay(<span class="number">10</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : Int1()	interrupt 2</span></span><br><span class="line"><span class="comment">* 函数功能		   : 外部中断1的中断函数</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Int1</span><span class="params">()</span>	interrupt 2		<span class="comment">//外部中断1的中断函数</span></span><br><span class="line">&#123;</span><br><span class="line">	delay(<span class="number">1000</span>);	 <span class="comment">//延时消抖</span></span><br><span class="line">	<span class="keyword">if</span>(k4==<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		beep_flag=!beep_flag;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="定时器和计数器"><a href="#定时器和计数器" class="headerlink" title="定时器和计数器"></a>定时器和计数器</h3><h4 id="定时器-计数器简介"><a href="#定时器-计数器简介" class="headerlink" title="定时器&#x2F;计数器简介"></a>定时器&#x2F;计数器简介</h4><p>定时器&#x2F;计数器（Timer&#x2F;Counter，简称T&#x2F;C）是单片机中最基本的接口之一。即可以定时又可以计数。常用于计数、延时、测量周期&#x2F;脉宽&#x2F;频率、提供定时脉冲信号等。</p>
<p>8051系列单片机至少含有2个16位的T&#x2F;C，STC89C51&#x2F;52含有3个T&#x2F;C。其中2个为基本定时器&#x2F;计数器T&#x2F;C0和T&#x2F;C1，另一个是T&#x2F;C2。可通过软件配置为定时器功能或者计数器功能。</p>
<p>定时&#x2F;计数器的工作原理： 定时&#x2F;计数器实质上是一个加1计数器。当工作在定时器模式时，对振荡源12分频的脉冲计数，即每个机器周期计数值加1，当加到计数器为全1时，再输入一个脉冲就使计数器回零。当工作在计数器模式时，计数脉冲来至外部脉冲输入引脚P3.4（T0）和P3.5（T1），当T0或T1脚上负跳变时计数值加1 ，识别管脚负跳变需要2个机器周期，即24个振荡周期。所以T0或T1脚输入的可计数的外部脉冲的最高频率为1&#x2F;24fosc，当晶振12MHZ时，最高计数频率为500KHz，高于此频率将计数出错。</p>
<p>定时器&#x2F;计数器内部结构：</p>
<p><img src="https://i.loli.net/2020/12/06/QjTtULSuerYwHEa.png" alt="24.png"></p>
<h4 id="定时器-计数器寄存器"><a href="#定时器-计数器寄存器" class="headerlink" title="定时器&#x2F;计数器寄存器"></a>定时器&#x2F;计数器寄存器</h4><h5 id="控制寄存器TCON"><a href="#控制寄存器TCON" class="headerlink" title="控制寄存器TCON"></a>控制寄存器TCON</h5><p><img src="https://i.loli.net/2020/12/06/n6qVLovPjYTKlaF.png" alt="25.png"></p>
<p>TF1：T1溢出中断请求标志位。</p>
<p>TR1：T1运行控制位。TR1置1时，T1开始工作；TR1置0时，T1停止工作。</p>
<p>TF0：T0溢出中断请求标志位。</p>
<p>TR0：T0运行控制位。</p>
<h5 id="工作方式寄存器TMOD"><a href="#工作方式寄存器TMOD" class="headerlink" title="工作方式寄存器TMOD"></a>工作方式寄存器TMOD</h5><p><img src="https://i.loli.net/2020/12/06/D7vUhyimA6bwpJd.png" alt="26.png"></p>
<p><img src="https://i.loli.net/2020/12/06/ADLrWyPutTdhc1s.png" alt="27.png"></p>
<h5 id="定时-计数器2控制寄存器T2CON"><a href="#定时-计数器2控制寄存器T2CON" class="headerlink" title="定时&#x2F;计数器2控制寄存器T2CON"></a>定时&#x2F;计数器2控制寄存器T2CON</h5><h4 id="定时器-计数器工作方式"><a href="#定时器-计数器工作方式" class="headerlink" title="定时器&#x2F;计数器工作方式"></a><img src="https://i.loli.net/2020/12/06/vVDf8czMtwhdKsJ.png" alt="28.png">定时器&#x2F;计数器工作方式</h4><p>通过工作方式寄存器TMOD的M0和M1组合，形成了定时器&#x2F;计数器的4种不同工作方式。T&#x2F;C0和T&#x2F;C1都可以工作在方式0、方式1、方式2工作，而方式3只有T&#x2F;C0才能工作。</p>
<h5 id="方式0"><a href="#方式0" class="headerlink" title="方式0"></a>方式0</h5><p>方式0为13位计数，由TL0的低5位（高3位未用）和TH0的8位组成。TL0的低5位溢出时向TH0进位，TH0溢出时，置位TCON中的TF0标志，向CPU发出中断请求。</p>
<p><img src="https://i.loli.net/2020/12/06/loafGYi4kCt5jSc.png" alt="29.png"></p>
<h5 id="方式1"><a href="#方式1" class="headerlink" title="方式1"></a>方式1</h5><p>方式1的计数位数是16位，由TL0作为低8位，TH0作为高8位，组成了16位加1计数器。</p>
<p><img src="https://i.loli.net/2020/12/06/5TdSobO9lrnmU31.png" alt="30.png"></p>
<h5 id="方式2"><a href="#方式2" class="headerlink" title="方式2"></a>方式2</h5><p>方式2为自动重装初值的8位计数方式。</p>
<p><img src="https://i.loli.net/2020/12/06/QqWrZ6VKAeYoMjp.png" alt="31.png"></p>
<h5 id="方式3"><a href="#方式3" class="headerlink" title="方式3"></a>方式3</h5><p>方式3只适用于定时&#x2F;计数器T0，工作方式3将T0分成为两个独立的8位计数器TL0和TH0。定时器T1处于方式3时相当于TR1&#x3D;0，停止计数。</p>
<p><img src="https://i.loli.net/2020/12/06/Ti7HIJz24DNna6A.png" alt="32.png"></p>
<h4 id="定时器-计数器使用方法"><a href="#定时器-计数器使用方法" class="headerlink" title="定时器&#x2F;计数器使用方法"></a>定时器&#x2F;计数器使用方法</h4><p>①对TMOD赋值，以确定T0和T1的工作方式。</p>
<p>②计算初值,并将其写入TH0、TL0或TH1、TL1。</p>
<p>③中断方式时，打开定时器中断（ET0&#x2F;ET1）及总中断EA。</p>
<p>④使TR0或TR1置位，启动定时&#x2F;计数器定时或计数</p>
<p>定时器&#x2F;计数器初值计算：</p>
<p>假如要定时1ms，定时器初值是多少？</p>
<p>计数脉冲个数N&#x3D;1ms&#x2F;1us&#x3D;1000个</p>
<p>定时器初值X&#x3D;2^16-1000&#x3D;65536-1000&#x3D;64536&#x3D;0XFC18</p>
<h3 id="定时器中断"><a href="#定时器中断" class="headerlink" title="定时器中断"></a>定时器中断</h3><h4 id="定时器0中断–控制LED"><a href="#定时器0中断–控制LED" class="headerlink" title="定时器0中断–控制LED"></a>定时器0中断–控制LED</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              定时器0中断--控制LED实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后D1小灯循环点亮1秒，熄灭1秒。使用单片机内部定时器可以实现准确延时。</span></span><br><span class="line"><span class="comment">注意事项：无。																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit led=P2^<span class="number">0</span>;	 <span class="comment">//定义P20口是led</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : Timer0Init</span></span><br><span class="line"><span class="comment">* 函数功能		   : 定时器0初始化</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer0Init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">		TMOD&amp;=<span class="number">0XFC</span>;   <span class="comment">//使定时器模式清零，11111100，无论初始为多少，后面一律变成??????00,在自行写入定时器工作方式 </span></span><br><span class="line">	TMOD|=<span class="number">0X01</span>;<span class="comment">//选择为定时器0模式，工作方式1，仅用TR0打开启动。</span></span><br><span class="line"></span><br><span class="line">	TH0=<span class="number">0XFC</span>;	<span class="comment">//给定时器赋初值，定时1ms</span></span><br><span class="line">	TL0=<span class="number">0X18</span>;	</span><br><span class="line">	ET0=<span class="number">1</span>;<span class="comment">//打开定时器0中断允许</span></span><br><span class="line">	EA=<span class="number">1</span>;<span class="comment">//打开总中断</span></span><br><span class="line">	TR0=<span class="number">1</span>;<span class="comment">//打开定时器			</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	Timer0Init();  <span class="comment">//定时器0初始化</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>);		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : void Timer0() interrupt 1</span></span><br><span class="line"><span class="comment">* 函数功能		   : 定时器0中断函数</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer0</span><span class="params">()</span> interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">static</span> u16 i;</span><br><span class="line">	TH0=<span class="number">0XFC</span>;	<span class="comment">//给定时器赋初值，定时1ms</span></span><br><span class="line">	TL0=<span class="number">0X18</span>;</span><br><span class="line">	i++;</span><br><span class="line">	<span class="keyword">if</span>(i==<span class="number">1000</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		i=<span class="number">0</span>;</span><br><span class="line">		led=~led;	</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="定时器1中断–控制数码管"><a href="#定时器1中断–控制数码管" class="headerlink" title="定时器1中断–控制数码管"></a>定时器1中断–控制数码管</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              定时器1中断--控制数码管实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后数码管间隔一秒循环显示0-F。使用单片机内部定时器可以实现准确延时。</span></span><br><span class="line"><span class="comment">注意事项：将LED点阵模块的J1短接片短接到VCC端																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit LSA=P3^<span class="number">0</span>;</span><br><span class="line">sbit LSB=P3^<span class="number">1</span>;</span><br><span class="line">sbit LSC=P3^<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">u8 code smgduan[<span class="number">17</span>]=&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,</span><br><span class="line">					<span class="number">0x7f</span>,<span class="number">0x6f</span>,<span class="number">0x77</span>,<span class="number">0x7c</span>,<span class="number">0x39</span>,<span class="number">0x5e</span>,<span class="number">0x79</span>,<span class="number">0x71</span>&#125;;<span class="comment">//显示0~F的值</span></span><br><span class="line">u8 n=<span class="number">0</span>;</span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : Timer1Init</span></span><br><span class="line"><span class="comment">* 函数功能		   : 定时器1初始化</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer1Init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	TMOD|=<span class="number">0X10</span>;<span class="comment">//选择为定时器1模式，工作方式1，仅用TR1打开启动。</span></span><br><span class="line"></span><br><span class="line">	TH1=<span class="number">0XFC</span>;	<span class="comment">//给定时器赋初值，定时1ms</span></span><br><span class="line">	TL1=<span class="number">0X18</span>;	</span><br><span class="line">	ET1=<span class="number">1</span>;<span class="comment">//打开定时器1中断允许</span></span><br><span class="line">	EA=<span class="number">1</span>;<span class="comment">//打开总中断</span></span><br><span class="line">	TR1=<span class="number">1</span>;<span class="comment">//打开定时器			</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	LSA=<span class="number">0</span>;</span><br><span class="line">	LSB=<span class="number">0</span>;</span><br><span class="line">	LSC=<span class="number">0</span>;</span><br><span class="line">	Timer1Init();  <span class="comment">//定时器1初始化</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>);		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : void Timer1() interrupt 3</span></span><br><span class="line"><span class="comment">* 函数功能		   : 定时器1中断函数</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer1</span><span class="params">()</span> interrupt 3</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">static</span> u16 i;</span><br><span class="line">	TH1=<span class="number">0XFC</span>;	<span class="comment">//给定时器赋初值，定时1ms</span></span><br><span class="line">	TL1=<span class="number">0X18</span>;</span><br><span class="line">	i++;</span><br><span class="line">	<span class="keyword">if</span>(i==<span class="number">1000</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		i=<span class="number">0</span>;</span><br><span class="line">		P0=smgduan[n++];</span><br><span class="line">		<span class="keyword">if</span>(n==<span class="number">16</span>)n=<span class="number">0</span>;	</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="简易交通灯"><a href="#简易交通灯" class="headerlink" title="简易交通灯"></a>简易交通灯</h3><p>本节所要实现的功能是：系统运行时，横向通行绿灯亮10秒，然后黄灯亮3秒，纵向通行绿灯亮10秒，黄灯亮3秒。数码管显示倒计时。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              简易交通灯实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后，数码管显示交通灯时间，注意：由于交通灯控制口和数码管位选共用了3个引脚，所以</span></span><br><span class="line"><span class="comment">			不能显示多位数字，如果强制显示，将会干扰交通灯LED状态。</span></span><br><span class="line"><span class="comment">注意事项：将LED点阵模块的J1短接片短接到VCC端																				  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit LSA=P2^<span class="number">2</span>;</span><br><span class="line">sbit LSB=P2^<span class="number">3</span>;</span><br><span class="line">sbit LSC=P2^<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">sbit rd1=P2^<span class="number">0</span>; <span class="comment">//D1 红色LED</span></span><br><span class="line">sbit yd1=P2^<span class="number">1</span>; <span class="comment">//D2 黄色LED</span></span><br><span class="line">sbit gd1=P2^<span class="number">2</span>; <span class="comment">//D3 绿色LED</span></span><br><span class="line"></span><br><span class="line">sbit rd2=P2^<span class="number">3</span>; <span class="comment">//D4 红色LED</span></span><br><span class="line">sbit yd2=P2^<span class="number">4</span>; <span class="comment">//D5 黄色LED</span></span><br><span class="line">sbit gd2=P2^<span class="number">5</span>; <span class="comment">//D6 绿色LED</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">u8 code smgduan[<span class="number">17</span>]=&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,</span><br><span class="line">					<span class="number">0x7f</span>,<span class="number">0x6f</span>,<span class="number">0x77</span>,<span class="number">0x7c</span>,<span class="number">0x39</span>,<span class="number">0x5e</span>,<span class="number">0x79</span>,<span class="number">0x71</span>&#125;;<span class="comment">//显示0~F的值</span></span><br><span class="line"><span class="type">char</span> sec1=<span class="number">0</span>,sec2=<span class="number">0</span>,sec3=<span class="number">0</span>,sec4=<span class="number">0</span>;</span><br><span class="line">u8 sec1flag=<span class="number">1</span>,sec2flag,sec3flag,sec4flag;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : Timer1Init</span></span><br><span class="line"><span class="comment">* 函数功能		   : 定时器1初始化</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer1Init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	TMOD|=<span class="number">0X10</span>;<span class="comment">//选择为定时器1模式，工作方式1，仅用TR1打开启动。</span></span><br><span class="line"></span><br><span class="line">	TH1=<span class="number">0XFC</span>;	<span class="comment">//给定时器赋初值，定时1ms</span></span><br><span class="line">	TL1=<span class="number">0X18</span>;	</span><br><span class="line">	ET1=<span class="number">1</span>;<span class="comment">//打开定时器1中断允许</span></span><br><span class="line">	EA=<span class="number">1</span>;<span class="comment">//打开总中断</span></span><br><span class="line">	TR1=<span class="number">1</span>;<span class="comment">//打开定时器			</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	LSA=<span class="number">1</span>;</span><br><span class="line">	LSB=<span class="number">1</span>;</span><br><span class="line">	LSC=<span class="number">1</span>;</span><br><span class="line">	Timer1Init();  <span class="comment">//定时器1初始化</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(sec1&lt;<span class="number">10</span>&amp;&amp;sec1flag==<span class="number">1</span>)		  <span class="comment">//横向通行绿灯亮10秒</span></span><br><span class="line">		&#123;</span><br><span class="line">			rd1=<span class="number">0</span>;		 <span class="comment">//纵向禁止通行	   红灯亮 黄灯灭 绿灯灭</span></span><br><span class="line">			yd1=<span class="number">1</span>;</span><br><span class="line">			gd1=<span class="number">1</span>;	  </span><br><span class="line"></span><br><span class="line">			rd2=<span class="number">1</span>;		 <span class="comment">//横向通行	   红灯灭 黄灯灭 绿灯亮</span></span><br><span class="line">			yd2=<span class="number">1</span>;</span><br><span class="line">			gd2=<span class="number">0</span>;</span><br><span class="line">			P0=smgduan[<span class="number">9</span>-sec1];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(sec2&lt;<span class="number">4</span>&amp;&amp;sec2flag==<span class="number">1</span>)  <span class="comment">//横向通行黄灯亮3秒</span></span><br><span class="line">		&#123;</span><br><span class="line">			rd1=<span class="number">0</span>;		 <span class="comment">//纵向禁止通行	   红灯亮 黄灯灭 绿灯灭</span></span><br><span class="line">			yd1=<span class="number">1</span>;</span><br><span class="line">			gd1=<span class="number">1</span>;	  </span><br><span class="line"></span><br><span class="line">			rd2=<span class="number">1</span>;		 <span class="comment">//横向通行	   红灯灭 黄灯亮 绿灯灭</span></span><br><span class="line">			yd2=<span class="number">0</span>;</span><br><span class="line">			gd2=<span class="number">1</span>;</span><br><span class="line">			P0=smgduan[<span class="number">3</span>-sec2];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(sec3&lt;<span class="number">10</span>&amp;&amp;sec3flag==<span class="number">1</span>)  <span class="comment">//纵向通行绿灯亮10秒</span></span><br><span class="line">		&#123;</span><br><span class="line">			rd1=<span class="number">1</span>;		 <span class="comment">//纵向通行	   红灯灭 黄灯灭 绿灯亮</span></span><br><span class="line">			yd1=<span class="number">1</span>;</span><br><span class="line">			gd1=<span class="number">0</span>;	  </span><br><span class="line"></span><br><span class="line">			rd2=<span class="number">0</span>;		 <span class="comment">//横向禁止通行	   红灯亮 黄灯灭 绿灯灭</span></span><br><span class="line">			yd2=<span class="number">1</span>;</span><br><span class="line">			gd2=<span class="number">1</span>;</span><br><span class="line">			P0=smgduan[<span class="number">10</span>-sec3];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(sec4&lt;<span class="number">4</span>&amp;&amp;sec4flag==<span class="number">1</span>)  <span class="comment">//纵向通行黄灯亮3秒</span></span><br><span class="line">		&#123;</span><br><span class="line">			rd1=<span class="number">1</span>;		 <span class="comment">//纵向通行	   红灯灭 黄灯亮 绿灯灭</span></span><br><span class="line">			yd1=<span class="number">0</span>;</span><br><span class="line">			gd1=<span class="number">1</span>;	  </span><br><span class="line"></span><br><span class="line">			rd2=<span class="number">0</span>;		 <span class="comment">//横向禁止通行	   红灯亮 黄灯灭 绿灯灭</span></span><br><span class="line">			yd2=<span class="number">1</span>;</span><br><span class="line">			gd2=<span class="number">1</span>;</span><br><span class="line">			P0=smgduan[<span class="number">3</span>-sec4];</span><br><span class="line">		&#125;</span><br><span class="line">				</span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名         : void Timer1() interrupt 3</span></span><br><span class="line"><span class="comment">* 函数功能		   : 定时器1中断函数</span></span><br><span class="line"><span class="comment">* 输    入         : 无</span></span><br><span class="line"><span class="comment">* 输    出         : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer1</span><span class="params">()</span> interrupt 3</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">static</span> u16 i;</span><br><span class="line">	TH1=<span class="number">0XFC</span>;	<span class="comment">//给定时器赋初值，定时1ms</span></span><br><span class="line">	TL1=<span class="number">0X18</span>;</span><br><span class="line">	i++;</span><br><span class="line">	<span class="keyword">if</span>(i==<span class="number">1000</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		i=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(sec1flag==<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			sec1++;</span><br><span class="line">			<span class="keyword">if</span>(sec1&gt;<span class="number">9</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				sec1=<span class="number">0</span>;</span><br><span class="line">				sec1flag=<span class="number">0</span>;</span><br><span class="line">				sec2flag=<span class="number">1</span>;</span><br><span class="line">			&#125;	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(sec2flag==<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			sec2++;</span><br><span class="line">			<span class="keyword">if</span>(sec2&gt;<span class="number">3</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				sec2=<span class="number">0</span>;</span><br><span class="line">				sec2flag=<span class="number">0</span>;	</span><br><span class="line">				sec3flag=<span class="number">1</span>;</span><br><span class="line">			&#125;		</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(sec3flag==<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			sec3++;</span><br><span class="line">			<span class="keyword">if</span>(sec3&gt;<span class="number">9</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				sec3=<span class="number">0</span>;</span><br><span class="line">				sec3flag=<span class="number">0</span>;</span><br><span class="line">				sec4flag=<span class="number">1</span>;</span><br><span class="line">			&#125;		</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(sec4flag==<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			sec4++;</span><br><span class="line">			<span class="keyword">if</span>(sec4&gt;<span class="number">3</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				sec4=<span class="number">0</span>;</span><br><span class="line">				sec4flag=<span class="number">0</span>;</span><br><span class="line">				sec1flag=<span class="number">1</span>;</span><br><span class="line">			&#125;		</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="串口通信"><a href="#串口通信" class="headerlink" title="串口通信"></a>串口通信</h3><h4 id="通信的概念"><a href="#通信的概念" class="headerlink" title="通信的概念"></a>通信的概念</h4><p>通信的方式可以分为多种，按照数据传送方式可分为串行通信和并行通信。按照通信的数据同步方式，可分为异步通信和同步通信。按照数据的传输方向又可分为单工、半双工和全双工通信。</p>
<h5 id="串行通信与并行通信"><a href="#串行通信与并行通信" class="headerlink" title="串行通信与并行通信"></a>串行通信与并行通信</h5><h6 id="串行通信"><a href="#串行通信" class="headerlink" title="串行通信"></a>串行通信</h6><p>串行通信是指使用一条数据线，将数据一位一位地依次传输，每一位数据占据一个固定的时间长度。其只需要少数几条线就可以在系统间交换信息，特别适用于计算机与计算机、计算机与外设之间的远距离通信。</p>
<p><img src="https://i.loli.net/2020/12/07/cbgF5lqsmoHE3uj.png" alt="33.png"></p>
<p>特点：传输线少，长距离传送时成本低，且可以利用电话网等现成的设备，但数据的传送控制比并行通信复杂。</p>
<h6 id="并行通信"><a href="#并行通信" class="headerlink" title="并行通信"></a>并行通信</h6><p>并行通信通常是将数据字节的各位用多条数据线同时进行传送，通常是8位、16位、32位等数据一起传输。</p>
<p><img src="https://i.loli.net/2020/12/07/1DCZknPlJx59G4y.png" alt="34.png"></p>
<p>特点：控制简单、传输速度快；由于传输线较多，长距离传送时成本高且接收方的各位同时接收存在困难，抗干扰能力差。</p>
<h5 id="异步通信与同步通信"><a href="#异步通信与同步通信" class="headerlink" title="异步通信与同步通信"></a>异步通信与同步通信</h5><h6 id="异步通信"><a href="#异步通信" class="headerlink" title="异步通信"></a>异步通信</h6><p>异步通信是指通信的发送与接收设备使用各自的时钟控制数据的发送和接收过程。为使双方的收发协调，要求发送和接收设备的时钟尽可能一致。异步通信是以字符（构成的帧）为单位进行传输，字符与字符之间的间隙（时间间隔）是任意的，但每个字符中的各位是以固定的时间传送的，即字符之间不一定有“位间隔”的整数倍的关系，但同一字符内的各位之间的距离均为“位间隔”的整数倍。</p>
<p><img src="https://i.loli.net/2020/12/07/q6nduDsHgCbQwmV.png" alt="35.png"></p>
<p>特点：不要求收发双方时钟的严格一致，实现容易，设备开销较小，但每个字符要附加2～3位用于起止位，各帧之间还有间隔，因此传输效率不高。</p>
<h6 id="同步通信"><a href="#同步通信" class="headerlink" title="同步通信"></a>同步通信</h6><p>同步通信时要建立发送方时钟对接收方时钟的直接控制，使双方达到完全同步。此时，传输数据的位之间的距离均为“位间隔”的整数倍，同时传送的字符间不留间隙，即保持位同步关系，也保持字符同步关系。发送方对接收方的同步可以通过两种方法实现。</p>
<p><img src="https://i.loli.net/2020/12/07/8kFAWwavgifyxdl.png" alt="36.png"></p>
<h5 id="单工、半双工与全双工通信"><a href="#单工、半双工与全双工通信" class="headerlink" title="单工、半双工与全双工通信"></a>单工、半双工与全双工通信</h5><h6 id="单工通信"><a href="#单工通信" class="headerlink" title="单工通信"></a>单工通信</h6><p>单工是指数据传输仅能沿一个方向，不能实现反向传输。</p>
<h6 id="半双工通信"><a href="#半双工通信" class="headerlink" title="半双工通信"></a>半双工通信</h6><p>半双工是指数据传输可以沿两个方向，但需要分时进行。</p>
<h6 id="全双工通信"><a href="#全双工通信" class="headerlink" title="全双工通信"></a>全双工通信</h6><p>全双工是指数据可以同时进行双向传输。</p>
<h5 id="通信速率"><a href="#通信速率" class="headerlink" title="通信速率"></a>通信速率</h5><p>衡量通信性能的一个非常重要的参数就是通信速率，通常以比特率(Bitrate)来表示。比特率是每秒钟传输二进制代码的位数，单位是：位／秒（bps）。如每秒钟传送240个字符，而每个字符格式包含10位(1个起始位、1个停止位、8个数据位)，这时的比特率为：10位×240个&#x2F;秒 &#x3D; 2400 bps</p>
<h4 id="串口通信简介"><a href="#串口通信简介" class="headerlink" title="串口通信简介"></a>串口通信简介</h4><p>串口通信(Serial Communication)，是指外设和计算机间，通过数据信号线、地线等，按位进行传输数据的一种通信方式，属于串行通信方式。串口是一种接口标准，它规定了接口的电气标准，没有规定接口插件电缆以及使用的协议。</p>
<p>RS232的通信协议比较简单，通常遵循96-N-8-1格式。</p>
<p>串口内部结构</p>
<p><img src="https://i.loli.net/2020/12/07/WFBrLnIxgMEQaKj.png" alt="37.png"></p>
<h4 id="串口相关寄存器"><a href="#串口相关寄存器" class="headerlink" title="串口相关寄存器"></a>串口相关寄存器</h4><h5 id="串口控制寄存器SCON"><a href="#串口控制寄存器SCON" class="headerlink" title="串口控制寄存器SCON"></a>串口控制寄存器SCON</h5><p><img src="https://i.loli.net/2020/12/07/LECvXmcIBnJsQtF.png" alt="38.png"></p>
<p>SM0和SM1为工作方式选择位：</p>
<p><img src="https://i.loli.net/2020/12/07/KQCVIltW29fz6Jd.png" alt="39.png"></p>
<p>SM2：多机通信控制位，主要用于方式2和方式3。当SM2&#x3D;1时可以利用收到的RB8来控制是否激活RI（RB8＝0时不激活RI，收到的信息丢弃；RB8＝1时收到的数据进入SBUF，并激活RI，进而在中断服务中将数据从SBUF读走）。当SM2&#x3D;0时，不论收到的RB8为0和1，均可以使收到的数据进入SBUF，并激活RI（即此时RB8不具有控制RI激活的功能）。通过控制SM2，可以实现多机通信。</p>
<p>REN：允许串行接收位。由软件置REN&#x3D;1，则启动串行口接收数据；若软件置REN&#x3D;0，则禁止接收。</p>
<p>TB8：在方式2或方式3中，是发送数据的第9位，可以用软件规定其作用。可以用作数据的奇偶校验位，或在多机通信中，作为地址帧&#x2F;数据帧的标志位。在方式0和方式1中，该位未用到。</p>
<p>RB8：在方式2或方式3中，是接收到数据的第9位，作为奇偶校验位或地址帧&#x2F;数据帧的标志位。在方式1时，若SM2&#x3D;0，则RB8是接收到的停止位。</p>
<p>TI：发送中断标志位。在方式0时，当串行发送第8位数据结束时，或在其它方式，串行发送停止位的开始时，由内部硬件使TI置1，向CPU发中断申请。在中断服务程序中，必须用软件将其清0，取消此中断申请。</p>
<p>RI：接收中断标志位。在方式0时，当串行接收第8位数据结束时，或在其它方式，串行接收停止位的中间时，由内部硬件使RI置1，向CPU发中断申请。也必须在中断服务程序中，用软件将其清0，取消此中断申请。</p>
<h5 id="电源控制寄存器PCON"><a href="#电源控制寄存器PCON" class="headerlink" title="电源控制寄存器PCON"></a>电源控制寄存器PCON</h5><p><img src="https://i.loli.net/2020/12/07/WKoSLQuDdTy1IGn.png" alt="40.png"></p>
<p>SMOD：波特率倍增位。在串口方式1、方式2、方式3时，波特</p>
<p>率与SMOD有关，当SMOD&#x3D;1时，波特率提高一倍。复位时，SMOD&#x3D;0。</p>
<h4 id="串口工作方式"><a href="#串口工作方式" class="headerlink" title="串口工作方式"></a>串口工作方式</h4><h5 id="方式0-1"><a href="#方式0-1" class="headerlink" title="方式0"></a>方式0</h5><p>方式0时，串行口为同步移位寄存器的输入输出方式。主要用于扩展并行输入或输出口。数据由RXD（P3.0）引脚输入或输出，同步移位脉冲由TXD（P3.1）引脚输出。发送和接收均为8位数据，低位在先，高位在后。波特率固定为fosc&#x2F;12。</p>
<p>①方式0输出</p>
<p><img src="https://i.loli.net/2020/12/07/PwnHAJVobMazWl3.png" alt="41.png"></p>
<p>②方式0输入</p>
<p><img src="https://i.loli.net/2020/12/07/4ZLMr2BE9IFHfpb.png" alt="42.png"></p>
<h5 id="方式1-1"><a href="#方式1-1" class="headerlink" title="方式1"></a>方式1</h5><p>方式1是10位数据的异步通信口。TXD为数据发送引脚，RXD为数据接收引脚，传送一帧数据的格式如下所示。其中1位起始位，8位数据位，1位停止位。</p>
<p><img src="https://i.loli.net/2020/12/07/4TwE29efK1uqJ3l.png" alt="43.png"></p>
<p>①方式1输出</p>
<p><img src="https://i.loli.net/2020/12/07/E8f4jOI5pVFAv7h.png" alt="44.png"></p>
<p>②方式1输入</p>
<p><img src="https://i.loli.net/2020/12/07/MIw8RfK61YTXGZU.png" alt="45.png"></p>
<p>用软件置REN为1时，接收器以所选择波特率的16倍速率采样RXD引脚电平，检测到RXD引脚输入电平发生负跳变时，则说明起始位有效，将其移入输入移位寄存器，并开始接收这一帧信息的其余位。接收过程中，数据从输入移位寄存器右边移入，起始位移至输入移位寄存器最左边时，控制电路进行最后一次移位。当RI&#x3D;0，且SM2&#x3D;0（或接收到的停止位为1）时，将接收到的9位数据的前8位数据装入接收SBUF，第9位（停止位）进入RB8，并置RI&#x3D;1，向CPU请求中断。</p>
<h5 id="方式2和方式3"><a href="#方式2和方式3" class="headerlink" title="方式2和方式3"></a>方式2和方式3</h5><p>方式2或方式3时为11位数据的异步通信口。TXD为数据发送引脚，<br>RXD为数据接收引脚 。 </p>
<p><img src="https://i.loli.net/2020/12/07/B1JgVqKY6HeRlFd.png" alt="46.png"></p>
<p>①方式2、方式3输出</p>
<p><img src="https://i.loli.net/2020/12/07/J7wbxnhk1Cqez93.png" alt="47.png"></p>
<p>发送开始时，先把起始位0输出到TXD引脚，然后发送移位寄存器的输出位（D0）到TXD引脚。每一个移位脉冲都使输出移位寄存器的各位右移一位，并由TXD引脚输出。 第一次移位时，停止位“1”移入输出移位寄存器的第9位上 ，以后每次移位，左边都移入0。当停止位移至输出位时，左边其余位全为0，检测电路检测到这一条件时，使控制电路进行最后一次移位，并置TI&#x3D;1，向CPU请求中断。</p>
<p>②方式2、方式3输入</p>
<p><img src="https://i.loli.net/2020/12/07/bEYRKcOW41o9S6F.png" alt="48.png"></p>
<p>接收时，数据从右边移入输入移位寄存器，在起始位0移到最左边时，控制电路进行最后一次移位。当RI&#x3D;0，且SM2&#x3D;0（或接收到的第9位数据为1）时，接收到的数据装入接收缓冲器SBUF和RB8（接收数据的第9位），置RI&#x3D;1，向CPU请求中断。如果条件不满足，则数据丢失，且不置位RI，继续搜索RXD引脚的负跳变。</p>
<h4 id="串口的使用"><a href="#串口的使用" class="headerlink" title="串口的使用"></a>串口的使用</h4><p>（1）如何计算波特率</p>
<p>方式0的波特率 &#x3D; fosc&#x2F;12</p>
<p>方式2的波特率 &#x3D;（2SMOD&#x2F;64）· fosc </p>
<p>方式1的波特率 &#x3D;（2SMOD&#x2F;32）·（T1溢出率）</p>
<p>方式3的波特率 &#x3D;（2SMOD&#x2F;32）·（T1溢出率）</p>
<p>T1 溢出率 &#x3D; fosc &#x2F;{12×[256 －（TH1）]}</p>
<p><img src="https://i.loli.net/2020/12/07/7qZDs6VG4wrjfyC.png" alt="49.png"></p>
<p>（2）串口初始化步骤</p>
<p>①确定T1的工作方式（TMOD寄存器）；</p>
<p>②确定串口工作方式（SCON寄存器）；</p>
<p>③计算T1的初值（设定波特率），装载TH1、TL1；</p>
<p>④启动T1（TCON中的TR1位）；</p>
<p>⑤如果使用中断，需开启串口中断控制位（IE寄存器）。</p>
<h4 id="串口模块电路"><a href="#串口模块电路" class="headerlink" title="串口模块电路"></a>串口模块电路</h4><p><img src="https://i.loli.net/2020/12/07/h3DLq6wQcuJ9C4m.png" alt="50.png"></p>
<h4 id="编写程序-5"><a href="#编写程序-5" class="headerlink" title="编写程序"></a>编写程序</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">*		              串口通信实验												  *</span></span><br><span class="line"><span class="comment">实现现象：下载程序后打开串口调试助手，将波特率设置为4800，选择发送的数据就可以显示</span></span><br><span class="line"><span class="comment">			在串口助手上。</span></span><br><span class="line"><span class="comment">注意事项：	串口调试助手操作步骤见实验内现象截图。																			  </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span>			 <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u16;	  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函数名         :UsartInit()</span></span><br><span class="line"><span class="comment">* 函数功能		   :设置串口</span></span><br><span class="line"><span class="comment">* 输入           : 无</span></span><br><span class="line"><span class="comment">* 输出         	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">UsartInit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	SCON=<span class="number">0X50</span>;			<span class="comment">//设置为工作方式1</span></span><br><span class="line">	TMOD=<span class="number">0X20</span>;			<span class="comment">//设置计数器工作方式2</span></span><br><span class="line">	PCON=<span class="number">0X80</span>;			<span class="comment">//波特率加倍</span></span><br><span class="line">	TH1=<span class="number">0XF3</span>;				<span class="comment">//计数器初始值设置，注意波特率是4800的</span></span><br><span class="line">	TL1=<span class="number">0XF3</span>;</span><br><span class="line">	ES=<span class="number">1</span>;						<span class="comment">//打开接收中断</span></span><br><span class="line">	EA=<span class="number">1</span>;						<span class="comment">//打开总中断</span></span><br><span class="line">	TR1=<span class="number">1</span>;					<span class="comment">//打开计数器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函 数 名       : main</span></span><br><span class="line"><span class="comment">* 函数功能		 : 主函数</span></span><br><span class="line"><span class="comment">* 输    入       : 无</span></span><br><span class="line"><span class="comment">* 输    出    	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	UsartInit();  <span class="comment">//	串口初始化</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>);		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">* 函数名         : Usart() interrupt 4</span></span><br><span class="line"><span class="comment">* 函数功能		  : 串口通信中断函数</span></span><br><span class="line"><span class="comment">* 输入           : 无</span></span><br><span class="line"><span class="comment">* 输出         	 : 无</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Usart</span><span class="params">()</span> interrupt 4</span><br><span class="line">&#123;</span><br><span class="line">	u8 receiveData;</span><br><span class="line">	receiveData=SBUF;<span class="comment">//出去接收到的数据</span></span><br><span class="line">	RI = <span class="number">0</span>;<span class="comment">//清除接收中断标志位</span></span><br><span class="line">	SBUF=receiveData;<span class="comment">//将接收到的数据放入到发送寄存器</span></span><br><span class="line">	<span class="keyword">while</span>(!TI);			 <span class="comment">//等待发送数据完成</span></span><br><span class="line">	TI=<span class="number">0</span>;						 <span class="comment">//清除发送完成标志位</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F%E6%98%AF%E9%AB%98%E4%BD%8E%E4%BD%8D%E9%A1%BA%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F%E6%98%AF%E9%AB%98%E4%BD%8E%E4%BD%8D%E9%A1%BA%E5%BA%8F/" class="post-title-link" itemprop="url">常用数据传输方式是高低位顺序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-07-04 21:12:16" itemprop="dateModified" datetime="2021-07-04T21:12:16+08:00">2021-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>串口、IIC总线、AD转换、DS18B20他们工作中或者时序中是先传高位还是低位？</p>
<p>串口传输数据时先传送字符的低位，后传送字符的高位。即低位（LSB）在前，高位（MSB）在后。</p>
<p>IIC总线传输数据时先传送字符的高位，后传送字符的低位。即高位（MSB）在前，低位（LSB）在后。</p>
<p>AD转换先传送字符的高位，后传送字符的低位。即高位（MSB）在前，低位（LSB）在后。</p>
<p>DS18B20传输数据时先传送字符的低位，后传送字符的高位。即低位（LSB）在前，高位（MSB）在后。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/%E5%88%9D%E8%AF%8632%E5%8D%95%E7%89%87%E6%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/%E5%88%9D%E8%AF%8632%E5%8D%95%E7%89%87%E6%9C%BA/" class="post-title-link" itemprop="url">初识STM32</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-10-31 22:03:13" itemprop="dateModified" datetime="2020-10-31T22:03:13+08:00">2020-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="什么是STM32"><a href="#什么是STM32" class="headerlink" title="什么是STM32"></a>什么是STM32</h2><h3 id="STM32的字面含义"><a href="#STM32的字面含义" class="headerlink" title="STM32的字面含义"></a>STM32的字面含义</h3><p>1、ST——意法半导体，是一个公司名，即SOC厂商。STM32等系列芯片的内核由ARM公司生产（ARM是一个IP厂商，本身生产芯片，将内核授权给各大SOC厂商使用而盈利），ST公司则负责STM32外围电路的设计。</p>
<p>2、M— Microelectronics的缩写，表示微控制器，大家注意微控制器（无MMU，主频较低，速度较慢）和微处理器（有MMU,主频较高，可跑Linux）的区别。<br><em>MMU:内存处理单元</em></p>
<p>3、32— 32bit的意思，表示这是一个32bit的微控制器</p>
<h2 id="STM32能做什么"><a href="#STM32能做什么" class="headerlink" title="STM32能做什么"></a>STM32能做什么</h2><p>1、串口—USART，用于跟跟串口接口的设备通信，比如：USB转串口模块、ESP8266 WIFI、GPS模块，GSM 模块，串口屏、指纹识别模块</p>
<p>2、内部集成电路—I2C，用于跟I2C接口的设备通信，比如：EEPROM、电容屏、陀螺仪MPU6050、0.96寸OLED模块</p>
<p>3、串行通信接口—SPI，用于跟SPI接口的设备通信，比如：串行FLASH、以太网W5500、音频模块VS1053</p>
<p>4、SDIO、FSMC的超级、I2S、ADC、GPIO</p>
<h2 id="STM32怎么选型"><a href="#STM32怎么选型" class="headerlink" title="STM32怎么选型"></a>STM32怎么选型</h2><h3 id="STM32分类"><a href="#STM32分类" class="headerlink" title="STM32分类"></a>STM32分类</h3><p><img src="https://i.loli.net/2020/10/31/x5dv6JXP1oqCrYh.png" alt="1.png"></p>
<h3 id="STM32的命名方法"><a href="#STM32的命名方法" class="headerlink" title="STM32的命名方法"></a>STM32的命名方法</h3><p><img src="https://i.loli.net/2020/10/31/PY1nF7Kvm9gIsD3.png" alt="2.png"></p>
<p><img src="https://i.loli.net/2020/10/31/GNgvuF413hOmLdi.png" alt="3.png"></p>
<h3 id="如何分配原理图引脚"><a href="#如何分配原理图引脚" class="headerlink" title="如何分配原理图引脚"></a>如何分配原理图引脚</h3><p><img src="https://i.loli.net/2020/10/31/kPChVvqt1KfiUAl.png" alt="4.png"></p>
<h3 id="如何寻找引脚的功能说明"><a href="#如何寻找引脚的功能说明" class="headerlink" title="如何寻找引脚的功能说明"></a>如何寻找引脚的功能说明</h3><p><img src="https://i.loli.net/2020/10/31/QtpzF8uBf1n293c.png" alt="5.png"></p>
<h3 id="数据手册中对引脚的功能定义"><a href="#数据手册中对引脚的功能定义" class="headerlink" title="数据手册中对引脚的功能定义"></a>数据手册中对引脚的功能定义</h3><p><img src="https://i.loli.net/2020/10/31/ex1uyaGVtIjsCJ3.png" alt="6.png"></p>
<h3 id="引脚的功能定义解读"><a href="#引脚的功能定义解读" class="headerlink" title="引脚的功能定义解读"></a>引脚的功能定义解读</h3><p><img src="https://i.loli.net/2020/10/31/zPxakTuUyVeF3ol.png" alt="7.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/WiFi%E7%9A%84STA%E5%92%8CAP%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/WiFi%E7%9A%84STA%E5%92%8CAP%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">WIFI的STA和AP模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-07-17 22:50:28" itemprop="dateModified" datetime="2021-07-17T22:50:28+08:00">2021-07-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Wifi模块包括两种工作模式AP和STA，在这两模式的支持下，无线图传产品可以实现一发多收的功能。下面我们就从AP和STA的基本概念开始了解它们。</p>
<h2 id="AP和STA的基本概念"><a href="#AP和STA的基本概念" class="headerlink" title="AP和STA的基本概念"></a>AP和STA的基本概念</h2><p> AP(Access Point，接点)：也就是无线接入点，是一个无线网络的创建者，是网络的中心节点。一般家庭或办公室使用的无线路由器就是一个AP。用大白话说，你可以把CC3200当做一个无线路由器，这个路由器的特点不能插入网线，没有接入Internet，只能等待其他设备的链接，并且智能接入一个设备。类似于点对点模式。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/WQW9qs"><img src="https://z3.ax1x.com/2021/07/17/WQW9qs.jpg" alt="WQW9qs.jpg"></a></p>
<p> STA(Station，站点)：每一个连接到无线网络中的终端（如笔记本电脑、PDA及其它可以联网的用户设备）都可称为一个站点，用大白话说也就是平时接入路由器的设备。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/WQWprj"><img src="https://z3.ax1x.com/2021/07/17/WQWprj.jpg" alt="WQWprj.jpg"></a></p>
<h2 id="AP和STA工作模式说明"><a href="#AP和STA工作模式说明" class="headerlink" title="AP和STA工作模式说明"></a>AP和STA工作模式说明</h2><h3 id="工作在AP的模式下"><a href="#工作在AP的模式下" class="headerlink" title="工作在AP的模式下"></a>工作在AP的模式下</h3><p>工作在AP模式下，手机、PAD、电脑等设备可以直接连上模块，可以很方便对用户设备进行控制，如下图所示：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/WQWPZn"><img src="https://z3.ax1x.com/2021/07/17/WQWPZn.jpg" alt="WQWPZn.jpg"></a></p>
<h3 id="工作在STA的模式下"><a href="#工作在STA的模式下" class="headerlink" title="工作在STA的模式下"></a>工作在STA的模式下</h3><p>这是一种基木的组网方式，由一个AP和许多STA组成，如下图。其特点是AP处于中心地位，STA之间的相互通信都通过AP转发完成。该模式下，WIFI模块工作在STA(CLIENT)模式。通过适当的设置，COM的数据与WIFI的网路数据相互转换。如下图所示：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/WQWiaq"><img src="https://z3.ax1x.com/2021/07/17/WQWiaq.jpg" alt="WQWiaq.jpg"></a></p>
<h2 id="其他网络简称的概念"><a href="#其他网络简称的概念" class="headerlink" title="其他网络简称的概念"></a>其他网络简称的概念</h2><p>SSID(Service Set Identifier):SSID,每个无线AP都应该有一个标示用于用户识别，SSID就是这个用于用户识别的的名字，也就是我们经常说到的wifi名。</p>
<p>BSSID:每一个网络设备都有其用于识别的物理地址，这个东西呢就叫MAC地址，这个东西一般情况下出厂会有一个默认值，可更改，也有其固定的命名格式，也是设备识别的标识符。这个BSSID呢是针对设备说的，对于STA的设备来说，拿到AP接入点的MAC地址就是这个BSSID。</p>
<p>ESSID是一个比较抽象的概念，它实际上就和ssid相同（本质也是一串字符），只是能如果有好几个无线路由器都叫这个名字，那么我们就相当于把这个ssid扩大了，所以这几个无线路由器共同的这个名字就叫ESSID。（也就是如果在一台路由器上释放的wifi信号叫某个名字如“China_CMCC”，这个名字“China_CMCC”就称为SSID；如果在好几个路由器上都释放了这个wifi信号，那么大家都叫“China_CMCC”，这个时候大家都遵循的这个名字就是ESSID</p>
<p>举个例子，一家公司面积比较大，安装了若干台无线接入点（AP或者无线路由器），公司员工只需要知道一个SSID就可以在公司范围内任意地方接入无线网络。BSSID其实就是每个无线接入点的MAC地址。当员工在公司内部移动的时候，SSID是不变的。但BSSID随着你切换到不同的无线接入点，是在不停变化的。</p>
<p>再举例来说，bssid就是具体的某个连锁店编号（001）或地址，ssid就是连锁店的名字或者照片，essid就是连锁店的总公司或者招牌or品牌。一般ssid和essid都是相同的。</p>
<p>RSSI:这个理解起来更简单，就是通过STA扫描到AP站点的信号强度。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhangbijun1230/article/details/84255319?utm_medium=distribute.pc_relevant_download.none-task-blog-baidujs-1.nonecase&depth_1-utm_source=distribute.pc_relevant_download.none-task-blog-baidujs-1.nonecase">https://blog.csdn.net/zhangbijun1230/article/details/84255319?utm_medium=distribute.pc_relevant_download.none-task-blog-baidujs-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant_download.none-task-blog-baidujs-1.nonecase</a></p>
<p><a target="_blank" rel="noopener" href="http://bbs.eeworld.com.cn/thread-1071725-1-1.html">http://bbs.eeworld.com.cn/thread-1071725-1-1.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/STM32%E7%9A%84%E5%A4%8D%E7%94%A8%E6%97%B6%E9%92%9F%E7%9A%84%E5%BC%80%E5%90%AF%E5%92%8C%E9%87%8D%E6%98%A0%E5%B0%84%E5%8A%9F%E8%83%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/STM32%E7%9A%84%E5%A4%8D%E7%94%A8%E6%97%B6%E9%92%9F%E7%9A%84%E5%BC%80%E5%90%AF%E5%92%8C%E9%87%8D%E6%98%A0%E5%B0%84%E5%8A%9F%E8%83%BD/" class="post-title-link" itemprop="url">STM32的复用时钟的开启和重映射功能</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-07-21 10:20:12" itemprop="dateModified" datetime="2021-07-21T10:20:12+08:00">2021-07-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近在学习STM32，在参考手册上了解到关于“复用”和“重映射”这些概念，刚开始没搞懂，通过这几天在网上查找资料和看手册，弄清楚了，先与大家分享，希望能对跟我一样的新手有所帮助吧。</p>
<p>为了优化64脚或100脚封装的外设数目，可以把一些复用功能重新映射到其他引脚上。设置复用<br>重映射和调试I&#x2F;O配置寄存器(AFIO_MAPR)实现引脚的重新映射。这时，复用功能不再映射到它<br>们的原始分配上。  </p>
<p>STM32上有很多I&#x2F;O口，也有很多的内置外设，像I2C,ADC,ISP,USART等 ，为了节省引出管脚，这些内置外设基本上是与I&#x2F;O口共用管脚的，也就是I&#x2F;O管脚的复用功能。但是STM32还有一特别之处就是：很多内置外设的I&#x2F;O复用引脚可以通过重映射功能，从不同的I&#x2F;O管脚引出，即使用了复用功能的引脚是可通过程序改变的。 知道了这些我们就不难理解上面代码的意思了，程序中用到的USART2外设的TX，RX分别对应PA2，PA3，但是我的学习板上的PA2,PA3引脚接了其他设备，但是为了还要用USART2， “RCC_APB2Periph_GPIOD |RCC_APB2Periph_AFIO”就打开了GPIOD重映射功能，把USART2设备的TX，RX映射到PD5,PD6上，我们在这两个引脚上接上MAX232串口芯片就可以使用USART2串口通信了。 </p>
<p>那各位各位该问：“USART2是不是可以映射到任意管脚呢？” 答案是否定的，它只能映射到固定的管脚，下图是USART2重映射表。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/WUsHQP"><img src="https://z3.ax1x.com/2021/07/21/WUsHQP.png" alt="WUsHQP.png"></a></p>
<p>其他外设的重映射可以参考STM3210x手册8.3节。</p>
<p>不是说使用了IO的复用功能就一定要启动RCC_APB2Periph_AFIO的Clock的，只有使用了AFIO的事件控制寄存器（AFIO_EVCR）、AFIO的重映射功能(AFIO_MAPR)以及外部中断(AFIO_EXTICRx)控制寄存器才需要开启AFIO的时钟，STM32参考手册从来没说过使用IO的复用功能就一定要开启AFIO时钟。例如下面的，最常用的USART1，如果你的板子上，默认用的就是PA9和PA10这两个IO作为USART1的TX和RX，那么也就是没有重映射（No Remap）这种情况下根本不需要开启AFIO时钟，只要开启USART1的外设时钟并开启对应GPIO复用功能就行了。</p>
<p>举例说明，默认复用功能只需开始对应外设时钟和对应GPIO复用功能即可，重映射功能除了上述之外，还需开启对应AFIO时钟。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/RfU7oF"><img src="https://z3.ax1x.com/2021/07/04/RfU7oF.png" alt="RfU7oF.png"></a></p>
<p>重映射步骤为:</p>
<p> 1.打开重映射时钟和USART重映射后的I&#x2F;O口引脚时钟,</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB|RCC_APB2Periph_AFIO,ENABLE); <span class="comment">//使能对应IO口的时钟，因为是复用功能所以还要使能AFIO时钟 </span></span><br></pre></td></tr></table></figure>

<p>2.I&#x2F;O口重映射开启. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GPIO_PinRemapConfig(GPIO_Remap_USART1,ENABLE); </span><br></pre></td></tr></table></figure>

<p>3.配制重映射后的引脚： 这里只需配置重映射后的I&#x2F;O（PB6,PB7）,原来的不需要去配置（PA9，PA10）。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6; </span><br><span class="line">GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</span><br><span class="line">GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz; </span><br><span class="line">GPIO_Init(GPIOB, &amp;GPIO_InitStructure); </span><br><span class="line"></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_7;</span><br><span class="line">GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING; </span><br><span class="line">GPIO_Init(GPIOB, &amp;GPIO_InitStructure); </span><br></pre></td></tr></table></figure>

<p>有时候，可能重映射仍然可能失败，在第一步之前加一句话，就应该没问题了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GPIO_AFIODeInit();</span><br></pre></td></tr></table></figure>


<p>简言之，若GPIO口使用了重映射栏中的外设功能，则需要开启AFIO时钟；只使用默认复用功能时，只开启相应外设时钟无需开启AFIO时钟。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/STM32%E5%9F%BA%E4%BA%8EFSMC%E7%9A%84SRAM%E6%89%A9%E5%B1%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/STM32%E5%9F%BA%E4%BA%8EFSMC%E7%9A%84SRAM%E6%89%A9%E5%B1%95/" class="post-title-link" itemprop="url">STM32基于FSMC的SRAM扩展</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-07-04 20:59:00" itemprop="dateModified" datetime="2021-07-04T20:59:00+08:00">2021-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>STM32F103ZET6属于STM32F103xE增强型系列,工作频率为72MHz,内置高速存储器(高达512K字节的闪存和64K字节的SRAM) ,丰富的外设资源足以满足大部分的一般应用,但对于一些需要采集处理较多数据.应用算法或使用GUI等场合,内置的SRAM就显得捉襟见肘了,这时就需要扩展SRAM了。</p>
<p>IS61LV51216是ISSI公司生产的常用16位SRAM异步存储芯片,内部512k存储容量足以满足多数场合应用需求,存取时间8~12ns ,全静态操作,不需时钟或刷新,兼容TTL标准接口,具有高速,可靠、易操作.低功耗等优点。</p>
<p>FSMC(灵活的静态存储器控制器)是STM32采用的一种新型存储器控制技术,包含四个主要模块:AHB接口.NOR闪存和PSRAM控制器、NAND闪存和PC卡控制器、外部设备接口。</p>
<p>STM32F103系列中的64脚的STM32F103Rx系列没有FSMC功能,无法扩展SRAM;100脚的STM32F103Vx系列的FSMC在使用时需要管脚复用,不仅设置起来更复杂一些,而且还需增加锁存器,FSMC本身也占用大量管脚,在许多应用场合中造成管脚分配困难，但成本却与144脚的STM32F103Zx系列相差不大,因此在需要扩展SRAM时除非对成本要求特别严格或有其他要求,一般较少选用STM32F103Vx系列。</p>
<p>硬件电路设计<br>STM32F103ZET6与IS61LV51216的硬件电路连接:管脚接法同时兼容容量较小但成本更低的IS61LV25616。由于篇幅原因,IS61LV51216芯片的A18-AO为地址线,在此没有用到的FSMC_A可以作为通用IO使用,I&#x2F;O15-I&#x2F;O0为数据线,CE为片选引脚,本例选择使用地址为bank1的第三个子区域,片选脚为FSMC_NE3,WE为写入使能引脚,控制存储器的写入和读取,DE为输出使能引脚。LB为低位控制脚,UB为高位控制脚,用于将32位数据分割为连续的16位数据进行操作。</p>
<p>————————————————<br>版权声明：本文为CSDN博主「EVERSPIN」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/EVERSPIN/article/details/110480180">原文链接</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/STM32%E5%9B%BA%E4%BB%B6%E5%BA%93%E5%B8%B8%E8%A7%81%E5%91%BD%E5%90%8D%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/STM32%E5%9B%BA%E4%BB%B6%E5%BA%93%E5%B8%B8%E8%A7%81%E5%91%BD%E5%90%8D%E6%96%B9%E5%BC%8F/" class="post-title-link" itemprop="url">STM32固件库常见命名方式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-07-31 14:37:01" itemprop="dateModified" datetime="2021-07-31T14:37:01+08:00">2021-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="STM32固件库常见命名方式"><a href="#STM32固件库常见命名方式" class="headerlink" title="STM32固件库常见命名方式"></a>STM32固件库常见命名方式</h1><table>
<thead>
<tr>
<th align="center">缩写</th>
<th align="center">外设&#x2F;单元</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ADC</td>
<td align="center">模数转换器</td>
</tr>
<tr>
<td align="center">BKP</td>
<td align="center">备份寄存器</td>
</tr>
<tr>
<td align="center">CAN</td>
<td align="center">控制器局域网模块</td>
</tr>
<tr>
<td align="center">DMA</td>
<td align="center">直接内存存取控制器</td>
</tr>
<tr>
<td align="center">EXTI</td>
<td align="center">外部中断事件控制器</td>
</tr>
<tr>
<td align="center">FLASH</td>
<td align="center">闪存存储器</td>
</tr>
<tr>
<td align="center">GPIO</td>
<td align="center">通用输入输出</td>
</tr>
<tr>
<td align="center">I2C</td>
<td align="center">内部集成电路</td>
</tr>
<tr>
<td align="center">IWDG</td>
<td align="center">独立看门狗</td>
</tr>
<tr>
<td align="center">NVIC</td>
<td align="center">嵌套中断向量列表控制器</td>
</tr>
<tr>
<td align="center">PWR</td>
<td align="center">电源&#x2F;功耗控制</td>
</tr>
<tr>
<td align="center">RCC</td>
<td align="center">复位与时钟控制器</td>
</tr>
<tr>
<td align="center">RTC</td>
<td align="center">实时时钟</td>
</tr>
<tr>
<td align="center">SPI</td>
<td align="center">串行外设接口</td>
</tr>
<tr>
<td align="center">SysTick</td>
<td align="center">系统嘀嗒定时器</td>
</tr>
<tr>
<td align="center">TIM</td>
<td align="center">通用定时器</td>
</tr>
<tr>
<td align="center">TIM1</td>
<td align="center">高级控制定时器</td>
</tr>
<tr>
<td align="center">USART</td>
<td align="center">通用同步异步接收发射端</td>
</tr>
<tr>
<td align="center">WWDG</td>
<td align="center">窗口看门狗</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/WhLplR"><img src="https://z3.ax1x.com/2021/07/27/WhLplR.png" alt="WhLplR.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/WhL961"><img src="https://z3.ax1x.com/2021/07/27/WhL961.png" alt="WhL961.png"></a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/STM32-GPIO%E6%A1%86%E5%9B%BE%E5%89%96%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/STM32-GPIO%E6%A1%86%E5%9B%BE%E5%89%96%E6%9E%90/" class="post-title-link" itemprop="url">STM32-GPIO框图剖析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-07-04 19:22:18" itemprop="dateModified" datetime="2021-07-04T19:22:18+08:00">2021-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="GPIO框图剖析"><a href="#GPIO框图剖析" class="headerlink" title="GPIO框图剖析"></a>GPIO框图剖析</h2><p>GPIO是通用输入输出端口的简称，简单来说就是STM32可控制的引脚，STM32芯片的GPIO引脚与外部设备连接起来，从而实现与外部通讯、控制以及数据采集的功能。STM32芯片的GPIO被分成很多组，每组有16个引脚，如型号为STM32F103VET6型号的芯片有GPIOA、GPIOB、GPIOC 至GPIOE 共5 组GPIO，芯片一共100 个引脚，其中GPIO就占了一大部分，所有的GPIO引脚都有基本的输入输出功能。</p>
<p>最基本的输出功能是由STM32控制引脚输出高、低电平，实现开关控制，如把GPIO引脚接入到LED灯，那就可以控制LED灯的亮灭，引脚接入到继电器或三极管，那就可以通过继电器或三极管控制外部大功率电路的通断。最基本的输入功能是检测外部输入电平，如把GPIO 引脚连接到按键，通过电平高低区分按键是否被按下。</p>
<p><img src="https://i.loli.net/2021/07/04/FXIZNSr63Qpi7x5.png" alt="1.png"></p>
<h3 id="基本结构分析"><a href="#基本结构分析" class="headerlink" title="基本结构分析"></a>基本结构分析</h3><h4 id="保护二极管及上、下拉电阻"><a href="#保护二极管及上、下拉电阻" class="headerlink" title="保护二极管及上、下拉电阻"></a>保护二极管及上、下拉电阻</h4><p>引脚的两个保护二级管可以防止引脚外部过高或过低的电压输入，当引脚电压高于VDD时，上方的二极管导通，当引脚电压低于VSS时，下方的二极管导通，防止不正常电压引入芯片导致芯片烧毁。尽管有这样的保护，并不意味着STM32的引脚能直接外接大功率驱动器件，如直接驱动电机，强制驱动要么电机不转，要么导致芯片烧坏，必须要加大功率及隔离电路驱动。</p>
<h4 id="P-MOS管-和-N-MOS管"><a href="#P-MOS管-和-N-MOS管" class="headerlink" title="P-MOS管 和 N-MOS管"></a>P-MOS管 和 N-MOS管</h4><p>推挽输出：<br>推挽输出模式，是根据这两个 MOS 管的工作方式来命名的。<br>在该结构中输入高电平时，上方的 P-MOS 导通，下方的 N-MOS 关闭，对外输出高电平；而在该结构中输入低电平时，N-MOS 管导通，P-MOS 关闭，对外输出低电平。当引脚高低电平切换时，两个管子轮流导通，一个负责灌电流，一个负责拉电流，使其负载能力和开关速度都比普通的方式有很大的提高。推挽输出的低电平为 0 伏，高电平为 3.3 伏。</p>
<p><img src="https://i.loli.net/2021/07/04/ANJjrdVRicT8w27.png" alt="2.png"></p>
<p>开漏输出模式：<br>上方的 P-MOS 管完全不工作，如果我们控制输出为 0，低电平，则 P-MOS 管关闭， N-MOS 管导通，使输出接地，若控制输出为 1 (它无法直接输出高电平)时，则 P-MOS 管和 N-MOS 管都关闭，所以引脚既不输出高电平，也不输出低电平，为高阻态。为正常使用时必须接上拉电阻，若有很多个开漏模式引脚连接到一起时，只有当所有引脚都输出高阻态，才由上拉电阻提供高电平，此高电平的电压为外部上拉电阻所接的电源的电压。若其中一个引脚为低电平，那线路就相当于短路接地，使得整条线路都为低电平，0 伏。</p>
<p><img src="https://i.loli.net/2021/07/04/OGIAxvTZ1mLREXp.png" alt="3.png"></p>
<p>推挽输出模式一般应用在输出电平为 0 和 3.3 伏而且需要高速切换开关状态的场合。在 STM32 的应用中，除了必须用开漏模式的场合，我们都习惯使用推挽输出模式。开漏输出一般应用在 I2C、SMBUS 通讯等需要“线与”功能的总线电路中，还用在电平不匹配的场合，如需要输出 5 伏的高电平，就可以在外部接一个上拉电阻， 上拉电源为 5 伏， 并且把 GPIO 设置为开漏模式，当输出高阻态时，由上拉电阻和电源向外输出 5 伏的电平。</p>
<p><img src="https://i.loli.net/2021/07/04/nfhepKDsAqCJd7W.png" alt="4.png"></p>
<h4 id="输出数据寄存器"><a href="#输出数据寄存器" class="headerlink" title="输出数据寄存器"></a>输出数据寄存器</h4><p>前面提到的双MOS管结构电路的输入信号，是由GPIO“输出数据寄存器GPIOx_ODR”提供的，因此我们通过修改输出数据寄存器的值就可以修改GPIO引脚的输出电平。而“置位&#x2F;复位寄存器GPIOx_BSRR”可以通过修改输出数据寄存器的值从而影响电路的输出。</p>
<h4 id="复用功能输出"><a href="#复用功能输出" class="headerlink" title="复用功能输出"></a>复用功能输出</h4><p>“复用功能输出”中的“复用”是指STM32的其它片上外设对GPIO引脚进行控制，此时GPIO引脚用作该外设功能的一部分，算是第二用途。从其它外设引出来的“复用功能输出信号”与GPIO本身的数据据寄存器都连接到双MOS管结构的输入中，通过图中的梯形结构作为开关切换选择。<br>例如我们使用USART串口通讯时，需要用到某个GPIO引脚作为通讯发送引脚，这个时候就可以把该GPIO引脚配置成USART串口复用功能，由串口外设控制该引脚，发送数据。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GPIOB16个IO全部输出0XFF</span></span><br><span class="line">GPIOB-&gt;ODR = <span class="number">0XFF</span>;</span><br></pre></td></tr></table></figure>

<h4 id="输入数据寄存器"><a href="#输入数据寄存器" class="headerlink" title="输入数据寄存器"></a>输入数据寄存器</h4><p>看GPIO 结构框图的上半部分，GPIO 引脚经过内部的上、下拉电阻，可以配置成上&#x2F;下拉输入，然后再连接到施密特触发器，信号经过触发器后，模拟信号转化为0、1 的数字信号，然后存储在“输入数据寄存器GPIOx_IDR”中，通过读取该寄存器就可以了解GPIO引脚的电平状态。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取GPIOB端口的16位数据值</span></span><br><span class="line">uint16_ttemp;</span><br><span class="line">temp = GPIOB-&gt;IDR;</span><br></pre></td></tr></table></figure>

<h4 id="复用功能输入"><a href="#复用功能输入" class="headerlink" title="复用功能输入"></a>复用功能输入</h4><p>与“复用功能输出”模式类似，在“复用功能输入模式”时，GPIO引脚的信号传输到STM32其它片上外设，由该外设读取引脚状态。同样，如我们使用USART串口通讯时，需要用到某个GPIO引脚作为通讯接收引脚，这个时候就可以把该GPIO引脚配置成USART串口复用功能，使USART可以通过该通讯引脚的接收远端数据。</p>
<h4 id="模拟输入输出"><a href="#模拟输入输出" class="headerlink" title="模拟输入输出"></a>模拟输入输出</h4><p>当GPIO引脚用于ADC采集电压的输入通道时，用作“模拟输入”功能，此时信号是不经过施密特触发器的，因为经过施密特触发器后信号只有0、1两种状态，所以ADC外设要采集到原始的模拟信号，信号源输入必须在施密特触发器之前。类似地，当GPIO引脚用于DAC作为模拟电压输出通道时，此时作为“模拟输出”功能，DAC的模拟信号输出就不经过双MOS管结构，模拟信号直接输出到引脚。</p>
<h3 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8种工作模式</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">GPIO_Mode_AIN = <span class="number">0x0</span>,<span class="comment">//模拟输入</span></span><br><span class="line">GPIO_Mode_IN_FLOATING = <span class="number">0x04</span>,<span class="comment">//浮空输入</span></span><br><span class="line">GPIO_Mode_IPD = <span class="number">0x28</span>,<span class="comment">//下拉输入</span></span><br><span class="line">GPIO_Mode_IPU = <span class="number">0x48</span>,<span class="comment">//上拉输入</span></span><br><span class="line">GPIO_Mode_Out_OD = <span class="number">0x14</span>,<span class="comment">//开漏输出</span></span><br><span class="line">GPIO_Mode_Out_PP = <span class="number">0x10</span>,<span class="comment">//推挽输出</span></span><br><span class="line">GPIO_Mode_AF_OD = <span class="number">0x1C</span>,<span class="comment">//复用开漏输出</span></span><br><span class="line">GPIO_Mode_AF_PP = <span class="number">0x18</span><span class="comment">//复用推挽输出</span></span><br><span class="line">&#125; GPIOMode_TypeDef;</span><br></pre></td></tr></table></figure>

<h4 id="输入模式（上拉、下拉、浮空、模拟）"><a href="#输入模式（上拉、下拉、浮空、模拟）" class="headerlink" title="输入模式（上拉、下拉、浮空、模拟）"></a>输入模式（上拉、下拉、浮空、模拟）</h4><p>在输入模式时，施密特触发器打开，输出被禁止，可通过输入数据寄存器GPIOx_IDR读取I&#x2F;O状态。其中输入模式，可设置为上拉、下拉、浮空和模拟输入四种。上拉和下拉输入很好理解，默认的电平由上拉或者下拉决定。浮空输入的电平是不确定的，完全由外部的输入决定，一般接按键的时候用的是这个模式。模拟输入则用于ADC 采集。</p>
<h4 id="输出模式（推挽、开漏）"><a href="#输出模式（推挽、开漏）" class="headerlink" title="输出模式（推挽、开漏）"></a>输出模式（推挽、开漏）</h4><p>在输出模式中，推挽模式时双MOS管以轮流方式工作，输出数据寄存器GPIOx_ODR可控制I&#x2F;O输出高低电平。开漏模式时，只有N-MOS管工作，输出数据寄存器可控制I&#x2F;O输出高阻态或低电平。输出速度可配置，有2MHz\10MHz\50MHz 的选项。此处的输出速度即I&#x2F;O支持的高低电平状态最高切换频率，支持的频率越高，功耗越大，如果功耗要求不严格，把速度设置成最大即可。</p>
<p>在输出模式时施密特触发器是打开的，即输入可用，通过输入数据寄存器GPIOx_IDR可读取I&#x2F;O的实际状态。</p>
<h4 id="复用功能（推挽、开漏）"><a href="#复用功能（推挽、开漏）" class="headerlink" title="复用功能（推挽、开漏）"></a>复用功能（推挽、开漏）</h4><p>复用功能模式中，输出使能，输出速度可配置，可工作在开漏及推挽模式，但是输出信号源于其它外设，输出数据寄存器GPIOx_ODR 无效;输入可用，通过输入数据寄存器可获取I&#x2F;O实际状态，但一般直接用外设的寄存器来获取该数据信号。</p>
<p>通过对GPIO寄存器写入不同的参数，就可以改变GPIO的工作模式，再强调一下，要了解具体寄存器时一定要查阅《STM32F10X-中文参考手册》中对应外设的寄存器说明。在GPIO外设中，控制端口高低控制寄存器CRH和CRL可以配置每个GPIO的工作模式和工作的速度，每4个位控制一个IO，CRH 控制端口的高八位，CRL控制端口的低8位，具体的看CRH和CRL的寄存器描述。</p>
<p><img src="https://i.loli.net/2021/07/04/EdMWjecut8f13Jp.jpg" alt="5.jpg"></p>
<p><img src="https://i.loli.net/2021/07/04/TKEi5a1nG4MupQJ.jpg" alt="6.jpg"></p>
<p>参考引用：</p>
<p>1、野火—《零死角玩转STM32-F103霸道》<br>2、《STM32F1xx中文参考手册》<br>3、《Cortex-M3内核编程手册》</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhoucong.top/2024/06/16/ISP%E4%B8%80%E9%94%AE%E4%B8%8B%E8%BD%BD%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Vikebt">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vikebt's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Vikebt's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/16/ISP%E4%B8%80%E9%94%AE%E4%B8%8B%E8%BD%BD%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">ISP一键下载原理分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-16 10:20:27" itemprop="dateCreated datePublished" datetime="2024-06-16T10:20:27+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-07-04 19:32:31" itemprop="dateModified" datetime="2021-07-04T19:32:31+08:00">2021-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ISP一键下载原理分析"><a href="#ISP一键下载原理分析" class="headerlink" title="ISP一键下载原理分析"></a>ISP一键下载原理分析</h2><h3 id="ISP一键下载原理分析-1"><a href="#ISP一键下载原理分析-1" class="headerlink" title="ISP一键下载原理分析"></a>ISP一键下载原理分析</h3><p>ISP指电路板上的空白元器件可以编程写入最终用户代码， 而不需要从电路板上取下元器件。 已经编程的器件也可以用ISP方式擦除或再编程。<br>使用ISP的时候需要用到自举程序（BootLoader） ， 自举程序存储在STM32器件的内部自举 ROM（系统存储器） 中。 其主要任务是通过一种可用的串行外设（USART、 CAN、 USB、 I2C等） 将应用程序下载到内部Flash存储器中。 每种串行接口都定义了相应的通信协议， 其中包含兼容的命令集和序列。  </p>
<h3 id="ISP普通下载"><a href="#ISP普通下载" class="headerlink" title="ISP普通下载"></a>ISP普通下载</h3><p>现在我们针对USART1的ISP进行分析， 通常的ISP下载的步骤如下：<br>1） 通过USB转串口线将电脑连接到STM32的USART1， 并打开电脑端的上位机；<br>2） 设置跳线保持BOOT0为高电平， BOOT1为低电平；<br>3） 复位单片机使其进入BootLoader模式， 通过上位机下载程序；<br>4） 下载完毕， 设置跳线保持BOOT0为低电平， BOOT1为低电平；<br>5） 复位单片机即可启动用户代码， 正常运行。<br>以上步骤有个不好的地方就是： 下载程序需要跳线及复位操作， 很繁琐。 理解了ISP的原理， 就理解一键ISP了。 它需要做的事情就是用上位机去控制BOOT0引脚和单片机的复位引脚， 电路图见下图。</p>
<p><img src="https://i.loli.net/2021/07/04/uIzJqgPrpychOiW.png" alt="image.png"></p>
<h3 id="BOOT配置"><a href="#BOOT配置" class="headerlink" title="BOOT配置"></a>BOOT配置</h3><p>在ISP下载电路中， 需要配置BOOT引脚， BOOT引脚不同的配置会产生不同的启动方式， 具体见下表。 </p>
<p><img src="https://i.loli.net/2021/07/04/WOLamyzgpdkj45P.png" alt="image.png"></p>
<h3 id="ISP一键下载"><a href="#ISP一键下载" class="headerlink" title="ISP一键下载"></a>ISP一键下载</h3><p>USB转串口大家都很熟悉， 一般是用RXD和TXD这两个引脚。 在一键ISP电路中， 我们需要用USB转串口的芯片的DTR引脚和RTS引脚来控制单片机的BOOT0和NRST， 原理如下：<br>1） 通过上位机控制U6（CH340G） 的RTS引脚为低电平， Q1导通， BOOT0的电平上拉为高电平（1K电阻直接接在3V3，接地的时候10k电阻直接接地）。<br>2） 通过上位机控制U6（CH340G） 的DTR引脚为高电平， 由于RTS为低电平， Q2导通， U18的2引脚为低电平， U18为一个模拟开关， 使能端由4引脚控制， 默认为高电平， U18的1引脚和2引脚导通， 所以NRST为低电平， 系统复位。<br>3） 单片机进入ISP模式（即BOOT0和BOOT1引脚电平被锁存之后，改变他们的引脚也不影响）， 此时可以将DTR引脚设置为低电平， RTS设置为高电平。 Q1和Q2处于截止状态， BOOT0（原接地）和NRST（被拉高）还原到初始状态。<br>4） 上位机将程序下载到单片机， 下载完毕之后， 程序自动运行。<br>5） 有人认为U18、 Q1、 Q2是多余的， 用U6的RTS和DTR直接控制也可以。 正常情况下， 这样理解没有问题， 但是他们忽略了一点， 就是在单片机上电瞬间， 如果USB转串口连接了电脑， DTR和RTS的电平是变化的， 如果处理不好， 单片机会一直进入ISP模式， 或者系统会复位多次， 这种情况是不允许的。<br>6） 于是， 就有了全新的一键ISP电路。 我们主要是分析上电瞬间的逻辑关系， 单片机上电时通过示波器观察波形得知DTR和RTS的电平是变化的， 但是也有一个规律就是： 当RTS为低电平的时候，DTR也是低电平， 因此一般情况下Q2不会导通， 但由于这两个IO口的电平存在“竞争冒险”， 会出现RTS的下降沿刚好遇到DTR的上升沿， 这个时候Q2导通， 导致系统复位， 而BOOT0此时有可能也为高电平， 就会进入ISP模式。 这个是不受我们控制的， 而我们不想系统出现这样的情况， 因此加入了模拟开关来切断这种干扰。<br>7） 加入模拟开关U18， 通过控制U18的4引脚的开关来达到隔离干扰电平的目的。 下面我们分析一下延时开关电路， 上电瞬间， 电容C65通过电阻R18来充电， 由于电阻100kΩ 很大， 电容的充电电流很小， 电容充电达到U18的4引脚的有效电平2V大概耗时1秒， 在这个1秒时间内U18的模拟开关是断开的， 因此RTS和DTR的干扰电平不会影响到系统复位。 这样就保证了系统正常运行。  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Vikebt</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false});</script></body>
</html>
